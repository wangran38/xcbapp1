(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/aHouseholder/Traceability/Traceability"],{"2b25":function(e,t,a){"use strict";a.r(t);var n=a("2bbb"),o=a("33ef");for(var i in o)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("7307");var u=a("828b"),c=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"12fcade6",null,!1,n["a"],void 0);t["default"]=c.exports},"2bbb":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(a.bind(null,"a7f4"))}},o=function(){var e=this,t=e.$createElement,a=(e._self._c,0===e.activeTab?e.formData.fromcontent.length||0:null),n=1===e.activeTab?e.images.length:null,o=1===e.activeTab?e.images.length:null;e._isMounted||(e.e0=function(t){e.activeTab=0},e.e1=function(t){e.activeTab=1}),e.$mp.data=Object.assign({},{$root:{g0:a,g1:n,g2:o}})},i=[]},"33ef":function(e,t,a){"use strict";a.r(t);var n=a("39e4"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},"39e4":function(e,t,a){"use strict";(function(e){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a("7eb4")),i=n(a("af34")),u=n(a("ee10")),c=a("4860"),r={onLoad:function(e){try{e.type&&(this.type=Number(e.type))}catch(t){}this.id=e.id,this.goodsname=e.goodsname,this.formData.goods_id=Number(e.id),this.uploadImageback()},data:function(){return{type:1,goodsname:null,id:null,activeTab:0,selectedSource:"",sourceTypes:["自家种植","合作社供货","批发市场进货","产地直采"],categories:["种植/养殖场景","进货单据","摊位实拍","商品细节","质检报告"],activeCategory:0,images:[],formData:{content:null,fromcontent:""}}},methods:{uploadImageback:function(){var e=this;return(0,u.default)(o.default.mark((function t(){var a;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c.api.getManyImages({goodsid:Number(e.id),limit:100,page:1});case 2:a=t.sent,200==a.code&&(console.log(a.data),e.images=(0,i.default)(a.data));case 4:case"end":return t.stop()}}),t)})))()},onSourceChange:function(e){this.selectedSource=this.sourceTypes[e.detail.value]},saveImage:function(t){return new Promise((function(a,n){e.uploadFile({url:"https://image.xcbdsc.com/group1/upload",name:"file",filePath:t,formData:{output:"json2"},success:function(e){a(JSON.parse(e.data))},fail:function(t){n(t),e.showToast({title:"上传失败",icon:"error"})}})}))},chooseImage:function(){var t=this;e.chooseImage({count:9-this.images.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var a=e.tempFilePaths.map((function(e){return{url:e}})),n=a.map((function(e){return t.saveImage(e.url)}));Promise.all(n).then(function(){var e=(0,u.default)(o.default.mark((function e(a){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a.forEach((function(e){c.api.manyImages({goodsid:Number(t.id),url:e.data.url}).then((function(e){t.images.push({url:e.data.url,id:e.data.id}),console.log(t.images)}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}})},deleteImage:function(t){var a=this;e.showModal({title:"提示",content:"确定要删除这张图片吗？",success:function(e){e.confirm&&c.api.delManyImages({id:t}).then((function(e){a.uploadImageback()}))}})},submitForm:function(){var t=this;return(0,u.default)(o.default.mark((function a(){var n,i;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=null,1==t.type?n=c.api.addTraceability:(t.formData.id=t.formData.goods_id,delete t.formData.goods_id,n=c.api.updateDish),a.next=4,n(t.formData);case 4:i=a.sent,console.log(i),e.showLoading({title:"提交中..."}),setTimeout((function(){e.hideLoading(),e.showToast({title:"提交成功，等待审核",icon:"success",duration:2e3})}),1500);case 8:case"end":return a.stop()}}),a)})))()}}};t.default=r}).call(this,a("df3c")["default"])},"69af":function(e,t,a){"use strict";(function(e,t){var n=a("47a9");a("89ee");n(a("3240"));var o=n(a("2b25"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(o.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},7307:function(e,t,a){"use strict";var n=a("7758"),o=a.n(n);o.a},7758:function(e,t,a){}},[["69af","common/runtime","common/vendor"]]]);