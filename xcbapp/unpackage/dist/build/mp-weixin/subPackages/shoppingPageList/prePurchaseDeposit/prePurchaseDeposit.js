(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/shoppingPageList/prePurchaseDeposit/prePurchaseDeposit"],{"0482":function(t,e,n){"use strict";n.r(e);var o=n("7650"),a=n("1118");for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);n("d77d");var i=n("828b"),s=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,"bffc4aa6",null,!1,o["a"],void 0);e["default"]=s.exports},"10d7":function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("89ee");o(n("3240"));var a=o(n("0482"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},1118:function(t,e,n){"use strict";n.r(e);var o=n("62de"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=a.a},"62de":function(t,e,n){"use strict";(function(t){var o=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("7eb4")),r=o(n("7ca3")),i=o(n("af34")),s=o(n("ee10")),u=o(n("b6a0")),c=n("789c"),d=n("4860");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){(0,r.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var p={mixins:[c.myMixin],data:function(){return{product:{},productImages:[],currentSwiperIndex:0,showDetail:!1,showTraceability:!1,showFullRules:!1,selectedPoint:null,deliveryPoints:[{id:1,name:"绿鲜社区店",address:"朝阳区光华路8号底商",pickupTime:"09:00-21:00"},{id:2,name:"智慧生活超市",address:"海淀区中关村大街12号",pickupTime:"08:30-22:00"},{id:3,name:"生鲜便利店",address:"西城区西单北大街109号",pickupTime:"10:00-20:00"}],shortRules:["定金支付后不可退换","提货时需出示订单二维码","预售商品到货后统一配送"],fullRules:["定金支付后不可退换，如商品未按约定时间到货，系统将自动退款并补偿5元优惠券","提货时需出示订单二维码，核对身份信息后方可提货，代提需提供双方有效证件","预售商品到货后将统一配送到您选择的提货点，到货后会通过短信通知，请在3天内提货","预订商品数量有限，每个用户ID限购5份，超出部分将按原价结算，不享受预售优惠","商品保质期为到货后3天，请在保质期内提货并食用，逾期未提视为自动放弃","如对商品质量有异议，请在提货后24小时内联系客服处理，逾期将不再受理"],fromData:{farmer_id:"",goods_num:1,price:0,payprice:0,payway:2,goods_arr:[],money:0},query:{farmersgoods_id:null,page:1,limit:10}}},onLoad:function(t){var e=t.query,n="string"===typeof e?JSON.parse(e):e;this.product=n||{},this.query.farmersgoods_id=n.farmersgoods_id,this.getData(),this.fromData.farmer_id=this.product.id||"",this.fromData.money=parseFloat(this.product.price)||0,this.deliveryPoints.length>0&&(this.selectedPoint=this.deliveryPoints[0].id)},computed:{totalAmount:function(){return isNaN(this.fromData.money)||isNaN(this.fromData.goods_num)||this.fromData.goods_num<1?0:new u.default(this.fromData.money).mul(this.fromData.goods_num).toNumber()}},methods:{getData:function(){var t=this;return(0,s.default)(a.default.mark((function e(){var n;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d.api.goodsinfoList(t.query);case 2:n=e.sent,t.productImages=[t.product.imglogo],n.data.listdata.forEach((function(e){e.imgs.split(",").length>1&&t.productImages.length<10&&(console.log(e.imgs.split(",")),t.productImages=[].concat((0,i.default)(t.productImages),(0,i.default)(e.imgs.split(","))))}));case 5:case"end":return e.stop()}}),e)})))()},onSwiperChange:function(t){this.currentSwiperIndex=t.detail.current},toggleDetail:function(){this.showDetail=!this.showDetail},selectPoint:function(t){this.selectedPoint=t},onKeyInput:function(t){var e=t.detail.value.trim(),n=parseInt(e);this.fromData.goods_num=isNaN(n)||n<1?1:n},minusGoods_num:function(){this.fromData.goods_num>1&&this.fromData.goods_num--},addGoods_num:function(){this.fromData.goods_num++},addToCart:function(){t.showToast({title:"已加入购物车",icon:"success",duration:1500})},handleSubmit:function(){var e=this;return(0,s.default)(a.default.mark((function n(){var o,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.selectedPoint){n.next=3;break}return t.showToast({title:"请选择提货点",icon:"none",duration:2e3}),n.abrupt("return");case 3:if(!(e.fromData.goods_num<1)){n.next=6;break}return t.showToast({title:"购买数量不能小于1",icon:"none",duration:2e3}),n.abrupt("return");case 6:if(!(e.fromData.money<=0)){n.next=9;break}return t.showToast({title:"商品价格异常，请刷新",icon:"none",duration:2e3}),n.abrupt("return");case 9:return e.fromData.price=e.totalAmount,e.fromData.payprice=e.totalAmount,e.fromData.goods_arr=[{goods_id:e.product.id||"",goodsname:e.product.goodsname||"",goodsnum:e.fromData.goods_num,price:e.fromData.price,pay_time:Date.now()}],n.prev=12,n.next=15,d.api.prePurchaseOrder(e.fromData);case 15:r=n.sent,200===r.code&&null!==(o=r.data)&&void 0!==o&&o.out_trade_no?e.startPayment(r.data.out_trade_no):(t.showToast({title:r.msg||"订单提交失败",icon:"error",duration:2e3}),e.fromData.goods_arr=[]),n.next=24;break;case 19:n.prev=19,n.t0=n["catch"](12),console.error("提交订单异常：",n.t0),t.showToast({title:"网络异常，请稍后重试",icon:"error",duration:2e3}),e.fromData.goods_arr=[];case 24:case"end":return n.stop()}}),n,null,[[12,19]])})))()},startPayment:function(e){var n=this;return(0,s.default)(a.default.mark((function o(){var r,i;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,d.api.wechatpay({out_trade_no:e});case 3:if(r=o.sent,200!==r.code||!r.data){o.next=9;break}i=f(f({},r.data),{},{timeStamp:r.data.timeStamp.toString(),nonceStr:r.data.nonceStr||"",package:r.data.package||"",signType:r.data.signType||"MD5",paySign:r.data.paySign||""}),t.requestPayment(f(f({},i),{},{success:function(){t.showToast({title:"预订成功",icon:"success",duration:2e3}),setTimeout((function(){return t.navigateBack({delta:1})}),2e3)},fail:function(){t.showToast({title:"支付已取消",icon:"none",duration:2e3})},complete:function(){n.fromData.goods_arr=[]}})),o.next=15;break;case 9:if(202!==r.code){o.next=14;break}return o.next=12,n.bindOpenIDAndPay(e);case 12:o.next=15;break;case 14:t.showToast({title:r.msg||"获取支付参数失败",icon:"error",duration:2e3});case 15:o.next=21;break;case 17:o.prev=17,o.t0=o["catch"](0),console.error("支付异常：",o.t0),t.showToast({title:"支付服务异常",icon:"error",duration:2e3});case 21:case"end":return o.stop()}}),o,null,[[0,17]])})))()},bindOpenIDAndPay:function(e){var n=this;return(0,s.default)(a.default.mark((function o(){var r,i;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,new Promise((function(e,n){t.login({provider:"weixin",success:e,fail:n})}));case 3:if(r=o.sent,!r.code){o.next=16;break}return o.next=7,d.api.bindingOpenid({code:r.code});case 7:if(i=o.sent,200!==i.code){o.next=13;break}return o.next=11,n.startPayment(e);case 11:o.next=14;break;case 13:t.showToast({title:"账号绑定失败",icon:"none",duration:2e3});case 14:o.next=17;break;case 16:t.showToast({title:"获取微信登录信息失败",icon:"none",duration:2e3});case 17:o.next=23;break;case 19:o.prev=19,o.t0=o["catch"](0),console.error("绑定OpenID异常：",o.t0),t.showToast({title:"绑定服务异常",icon:"none",duration:2e3});case 23:case"end":return o.stop()}}),o,null,[[0,19]])})))()}}};e.default=p}).call(this,n("df3c")["default"])},7650:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"a7f4"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"8858"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.productImages.length),o=t.totalAmount.toFixed(2);t._isMounted||(t.e0=function(e){t.showTraceability=!0},t.e1=function(e){t.showFullRules=!0},t.e2=function(e){t.showTraceability=!1},t.e3=function(e){t.showFullRules=!1}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:o}})},r=[]},9106:function(t,e,n){},d77d:function(t,e,n){"use strict";var o=n("9106"),a=n.n(o);a.a}},[["10d7","common/runtime","common/vendor"]]]);