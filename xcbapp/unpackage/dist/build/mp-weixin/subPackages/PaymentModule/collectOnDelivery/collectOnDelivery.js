(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackages/PaymentModule/collectOnDelivery/collectOnDelivery"],{"43ca":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"a7f4"))}},a=function(){var e=this.$createElement,t=(this._self._c,this.initTime(this.createtime));this.$mp.data=Object.assign({},{$root:{m0:t}})},o=[]},6976:function(e,t,n){"use strict";n.r(t);var r=n("43ca"),a=n("9321");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("a412");var c=n("828b"),s=Object(c["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);t["default"]=s.exports},"6f23":function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("89ee");r(n("3240"));var a=r(n("6976"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},9321:function(e,t,n){"use strict";n.r(t);var r=n("f6b4"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},a412:function(e,t,n){"use strict";var r=n("cb94"),a=n.n(r);a.a},cb94:function(e,t,n){},f6b4:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),o=r(n("7ca3")),c=r(n("ee10")),s=n("4860");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={data:function(){return{isPayment:!1,out_trade_no:null,createtime:null,productList:[],totalPrice:0,otherFees:0,totalAmount:0,countDownTime:15,countDown:null,isTimeOut:!1,formattedCountDown:"",PaymentTimer:null,paymentMethods:[{title:"微信支付",code:1},{title:"积分支付",code:2},{title:"数字人民币",code:3}],selectedPaymentMethod:2,supportMethod:[1,2]}},mounted:function(){var t=this;this.startCountDown(),this.PaymentTimer=setInterval((0,c.default)(a.default.mark((function n(){var r,o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s.api.getorderinfo({out_trade_no:t.out_trade_no});case 2:r=n.sent,o=r.data,2==o.is_pay&&""!=o.success_time&&(clearInterval(t.PaymentTimer),e.redirectTo({url:"/pages/orders/orders?orderStatus=3"}));case 5:case"end":return n.stop()}}),n)}))),2500)},beforeDestroy:function(){this.clearCountDown()},onLoad:function(t){var n=this;return(0,c.default)(a.default.mark((function r(){var o,c;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n.out_trade_no=t.out_trade_no,r.next=3,s.api.myorders(t);case 3:o=r.sent,200==o.code?(c=o.data.listdata[0],n.createtime=c.createtime,n.productList=c.list_arr,n.totalPrice=c.price,n.totalAmount=n.totalPrice+n.otherFees):e.showToast({title:o.msg||o.message});case 5:case"end":return r.stop()}}),r)})))()},onUnload:function(){clearInterval(this.PaymentTimer)},methods:{initTime:function(e){var t=new Date(e).getTime(),n=10===String(t).length?new Date(1e3*parseInt(t)):new Date(parseInt(t)),r=n.getFullYear(),a=n.getMonth()+1;a<10&&(a="0"+a);var o=n.getDate();o<10&&(o="0"+o);var c=n.getHours();c<10&&(c="0"+c);var s=n.getMinutes();s<10&&(s="0"+s);var i=n.getSeconds();i<10&&(i="0"+i);var u=r+"-"+a+"-"+o+" "+c+":"+s+":"+i;return u},goBack:function(){e.navigateBack()},selectPaymentMethod:function(e){this.selectedPaymentMethod=e.code},startPayment:function(t){var n=this;return(0,c.default)(a.default.mark((function t(){var r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.api.wechatpay({out_trade_no:n.out_trade_no});case 2:r=t.sent,200==r.code?(r.data.timeStamp+="",e.requestPayment(u({},r.data))):202==r.code?e.login({provider:"true",success:function(){var t=(0,c.default)(a.default.mark((function t(o){var c,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.api.bindingOpenid({code:o.code});case 2:if(c=t.sent,console.log(c,r),200!=c.code){t.next=11;break}return t.next=7,s.api.wechatpay({out_trade_no:n.out_trade_no});case 7:i=t.sent,200==i.code?(i.data.timeStamp+="",e.requestPayment(u({},i.data))):e.showToast({title:i.message,icon:"error"}),t.next=12;break;case 11:e.showToast({title:c.message,icon:"error"});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}):e.showToast({title:r.msg||r.message,icon:"error"});case 4:case"end":return t.stop()}}),t)})))()},prepay:function(){var t=this;return(0,c.default)(a.default.mark((function n(){var r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.supportMethod.includes(t.selectedPaymentMethod)){n.next=17;break}n.t0=t.selectedPaymentMethod,n.next=1===n.t0?4:2===n.t0?6:3===n.t0?13:15;break;case 4:return t.startPayment(t.out_trade_no),n.abrupt("break",15);case 6:return e.getSetting({withSubscriptions:!0,success:function(t){t.subscriptionsSetting.mainSwitch?console.log("用户已订阅"):e.openSetting({withSubscriptions:!0,success:function(e){console.log(e.subscriptionsSetting)}})}}),n.next=9,s.api.payscore({out_trade_no:t.out_trade_no});case 9:return r=n.sent,console.log(r),200==r.code?(e.showToast({title:"支付成功",icon:"success"}),t.isPayment=!0,t.clearCountDown(),clearInterval(t.PaymentTimer),e.redirectTo({url:"/pages/orders/orders?orderStatus=3"})):e.showToast({title:r.msg||r.message,icon:"error"}),n.abrupt("break",15);case 13:return console.log("数字人民币"),n.abrupt("break",15);case 15:n.next=18;break;case 17:e.showToast({title:"暂未开通"+t.paymentMethods[t.selectedPaymentMethod-1].title,icon:"error"});case 18:case"end":return n.stop()}}),n)})))()},startCountDown:function(){var e=this,t=60*this.countDownTime;this.countDown=setInterval((0,c.default)(a.default.mark((function n(){var r,o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(t<=0)){n.next=5;break}return e.isTimeOut=!0,e.clearCountDown(),console.log("订单超时，已自动取消"),n.abrupt("return");case 5:r=Math.floor(t/60),o=t%60,e.formattedCountDown="".concat(e.padZero(r),":").concat(e.padZero(o)),t--;case 9:case"end":return n.stop()}}),n)}))),1e3)},clearCountDown:function(){this.countDown&&clearInterval(this.countDown)},padZero:function(e){return e<10?"0".concat(e):e.toString()}}};t.default=l}).call(this,n("df3c")["default"])}},[["6f23","common/runtime","common/vendor"]]]);