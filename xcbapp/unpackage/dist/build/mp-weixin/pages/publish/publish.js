(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/publish"],{"12f1":function(t,e,i){"use strict";i.r(e);var o=i("1555"),n=i("9383");for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);i("b537");var s=i("828b"),r=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=r.exports},1555:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(i.bind(null,"a7f4"))}},n=function(){var t=this.$createElement;this._self._c},a=[]},"587b":function(t,e,i){"use strict";(function(t,e){var o=i("47a9");i("89ee");o(i("3240"));var n=o(i("12f1"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"6dda":function(t,e,i){"use strict";(function(t){var o=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i("7eb4")),a=o(i("7ca3")),s=o(i("af34")),r=o(i("ee10")),c=i("4860"),u=o(i("fce1")),d=i("64af");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){(0,a.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var f={data:function(){return{pageData:[],showEditPopup:!1,currentItem:{},categories:[],pickerRange:[],selectedCategoryIndex:0,imageUploaded:!1,showEditPopup1:!1,showEditPopup2:!1,pickerRange1:[],selectedCategoryIndex1:0,itemDescription:"",itemPrice:"",marketList:[],candidates:["斤","瓶","桶","个"],candidate2:["元"],unit:"",unit2:"",tijiaoPrice:"",isloaded:!1,iconStatus:!0,isShowItems:!1,tempItem:null}},mixins:[u.default],onLoad:function(){this.isloaded=!0},onShow:function(){this.reloadData()},methods:{operation:function(t){this.showEditPopup2=!0,this.tempItem=t},routerPush:function(){t.navigateTo({url:"/subPackages/aHouseholder/Traceability/Traceability?id=".concat(this.tempItem.id,"&goodsname=").concat(this.tempItem.goodsname)})},removeItem:function(){var e=this;return(0,r.default)(n.default.mark((function i(){var o,a;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o={id:e.tempItem.id,isshow:2},i.next=3,c.api.editgoods(o);case 3:a=i.sent,200==a.code?(t.showToast({title:"删除成功",icon:"success"}),e.reloadData(),e.closePopup()):t.showToast({title:"删除失败",icon:"error"});case 5:case"end":return i.stop()}}),i)})))()},clicKexampleBody:function(){this.iconStatus=!this.iconStatus,this.isShowItems=!this.isShowItems},selectItem:function(t){this.unit=t,this.iconStatus=!this.iconStatus,this.isShowItems=!this.isShowItems},fetchCategories:function(){var t=this;c.api.cglist().then((function(e){if(200===e.code){var i=e.data.listdata.map((function(t){return{id:t.id,content:t.content}}));t.categories=i,t.pickerRange=(0,s.default)(i.map((function(t){return t.content})))}}))},fetchMarketList:function(){var e=this;return(0,r.default)(n.default.mark((function i(){var o,a,r;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,t.getStorageSync("token"),o={limit:100,page:1},i.next=5,c.api.getMyShops(h({token:e.token},o));case 5:a=i.sent,200===a.code?(r=a.data.listdata.map((function(t){return{id:t.id,title:t.title}})),e.marketList=r,e.pickerRange1=(0,s.default)(r.map((function(t){return t.title})))):console.error("Failed to fetch market list:",a.msg),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](0),console.error("Error fetching market list:",i.t0);case 12:case"end":return i.stop()}}),i,null,[[0,9]])})))()},onCategoryChange:function(t){this.selectedCategoryIndex=t.detail.value,this.currentItem.category_id=this.categories[this.selectedCategoryIndex].id},onMarketChange:function(t){this.selectedCategoryIndex1=t.detail.value,this.currentItem.market_id=this.marketList[this.selectedCategoryIndex1].id},fetchData:function(t){return(0,r.default)(n.default.mark((function e(){var i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.api.getCommdityList(t);case 2:return i=e.sent,e.abrupt("return",i.data);case 4:case"end":return e.stop()}}),e)})))()},goTorelePage:function(){t.navigateTo({url:"/pages/release/release"})},edit:function(){this.currentItem=h({},this.tempItem),this.fetchCategories(),this.showEditPopup=!0,this.fetchCommodityDetails(this.tempItem.id)},fetchCommodityDetails:function(t){var e=this;c.api.getCommodityDetails(t).then((function(t){if(200===t.code){var i=t.data.listdata[0];e.currentItem.goodsname=i.goodsname,e.currentItem.imglogo=i.imglogo;var o=e.categories.findIndex((function(t){return t.id===i.category_id}));-1!==o&&(e.selectedCategoryIndex=o)}}))},uploadcuisine:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var i=t.tempFilePaths;if(i.length>0){console.log(66676,t.tempFiles[0]);var o=(0,d.useUpload)({uploadPath:"/group1/upload",tempFilePaths:i[0],file:t.tempFiles[0]}),n=o.upload;o.request;n().then((function(t){t=JSON.parse(t),e.currentItem.imglogo=t.data.url}))}}})},shelves:function(){this.currentItem=h({},this.tempItem),console.log(this.currentItem),this.showEditPopup1=!0,this.fetchMarketList()},closePopup:function(){this.showEditPopup=!1,this.showEditPopup1=!1,this.showEditPopup2=!1,this.itemPrice=""},confirmEdit:function(){var e=this;if(this.currentItem.id)if(this.imageUploaded||this.currentItem.imglogo){var i=this.currentItem,o=i.id,n=i.category_id,a=i.goodsname,s=i.imglogo;c.api.editGoods({id:o,category_id:n,goodsname:a,imglogo:s}).then((function(i){200===i.code?(t.showToast({title:"商品修改成功",icon:"success"}),e.reloadData(),e.closePopup()):t.showToast({title:i.msg||"商品修改失败",icon:"none"})}))}else t.showToast({title:"请上传图片",icon:"none"});else t.showToast({title:"商品 ID 不正确",icon:"none"})},confirmShelves:function(){var e=this;console.log("Goods ID:",this.currentItem.id),this.itemPrice?this.unit?c.api.addCommodityToShop({goods_id:this.currentItem.id,shop_id:this.marketList[this.selectedCategoryIndex1].id,content:this.itemDescription,price:parseFloat(this.itemPrice),weight_name:this.unit}).then((function(i){200===i.code?(t.showToast({title:"上架成功"}),e.closePopup(),e.reloadData()):t.showToast({title:"上架失败",icon:"none"})})):t.showToast({title:"请选择单位",icon:"none"}):t.showToast({title:"请填写价格",icon:"none"})}}};e.default=f}).call(this,i("df3c")["default"])},9383:function(t,e,i){"use strict";i.r(e);var o=i("6dda"),n=i.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);e["default"]=n.a},"9ec1":function(t,e,i){},b537:function(t,e,i){"use strict";var o=i("9ec1"),n=i.n(o);n.a}},[["587b","common/runtime","common/vendor"]]]);