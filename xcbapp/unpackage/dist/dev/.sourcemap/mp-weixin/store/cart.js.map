{"version":3,"file":"cart.js","sources":["store/cart.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport Decimal from 'decimal'\n\nexport const useCartStore = defineStore('cart', {\n  // 状态：相当于 Vuex 的 state\n  state: () => ({\n    carts: [],\n  }),\n\n  // Getters：相当于 Vuex 的 getters\n  getters: {\n    // 计算指定店铺的总价\n    cartTotalByShopId: (state) => (shopId) => {\n      // 筛选出指定店铺的商品\n      const shopItems = shopId ? state.carts.filter(i => i.shop_id == shopId) : state.carts;\n      \n      // 计算总价\n      return shopItems.reduce((sum, item) => {\n        return new Decimal(item.price).mul(item.tempCount).add(sum).toNumber();\n      }, 0);\n    },\n\n    // 获取指定商品的数量\n    getTempCount: (state) => (id) => {\n      const item = state.carts.find(i => i.id === id);\n      return item ? item.tempCount : 0;\n    },\n\n    // 计算指定店铺的商品数量\n    cartsLengthByShopId: (state) => (shopId) => {\n      return shopId ? state.carts.filter(i => i.shop_id == shopId).length : state.carts.length || 0;\n    },\n\n    // 获取指定店铺的所有商品\n    getCartsByShopId: (state) => (shopId) => {\n      return shopId ? state.carts.filter(i => i.shop_id == shopId) : state.carts;\n    }\n  },\n\n  // Actions：相当于 Vuex 的 mutations 和 actions 的结合\n  actions: {\n    // 数量加1\n    addItem(item) {\n      // 查找购物车中是否存在该商品\n      const index = this.carts.findIndex(i => i.id === item.id)\n      \n      if (index !== -1) { \n        // 不等于-1就相当于存在，就商品数量就自增1\n        this.carts[index].tempCount = new Decimal(this.carts[index].tempCount).add(new Decimal(1)).toNumber();\n      } else {\n        // 不存在就新增\n        this.carts.push({\n          ...item,\n          tempCount: 1\n        });\n      }\n    },\n    \n    // 数量减一\n    subItem(item) {\n      const index = this.carts.findIndex(i => i.id === item.id);\n      \n      if (index !== -1) {  // 检查购物车里是否有订单\n        // 大于1就减掉1\n        if (this.carts[index].tempCount > 1) {\n          this.carts[index].tempCount = new Decimal(this.carts[index].tempCount).sub(new Decimal(1)).toNumber();\n        } else {\n          // 删除数组项\n          this.carts.splice(index, 1);\n        }\n      }\n    },\n    \n    // 清空购物车\n    clearCart() {\n      console.log('clearCart action triggered');\n      this.carts = [];\n    },\n\n    // 任意输入数量\n    anyNumber(item) {\n      const index = this.carts.findIndex(i => i.id === item.id);\n      // 不等于-1就相当于存在，就商品数量就修改数量\n      if (index !== -1) {\n        // 如果输入数量小于0.1就删除数组\n        if (item.count < 0.1){\n          this.carts.splice(index, 1);\n        } else {\n          this.carts[index].tempCount = item.count;\n        }\n      } else {\n        // 数量要大于0.1才能push进去\n        if (item.count >= 0.1){\n          // 反之不存在就新增\n          this.carts.push({\n            ...item,\n            tempCount: item.count\n          });\n        }\n      }\n    }\n  }\n});"],"names":["defineStore","Decimal","uni"],"mappings":";;AAGY,MAAC,eAAeA,cAAW,YAAC,QAAQ;AAAA;AAAA,EAE9C,OAAO,OAAO;AAAA,IACZ,OAAO,CAAE;AAAA,EACb;AAAA;AAAA,EAGE,SAAS;AAAA;AAAA,IAEP,mBAAmB,CAAC,UAAU,CAAC,WAAW;AAExC,YAAM,YAAY,SAAS,MAAM,MAAM,OAAO,OAAK,EAAE,WAAW,MAAM,IAAI,MAAM;AAGhF,aAAO,UAAU,OAAO,CAAC,KAAK,SAAS;AACrC,eAAO,IAAIC,cAAO,QAAC,KAAK,KAAK,EAAE,IAAI,KAAK,SAAS,EAAE,IAAI,GAAG,EAAE,SAAQ;AAAA,MACrE,GAAE,CAAC;AAAA,IACL;AAAA;AAAA,IAGD,cAAc,CAAC,UAAU,CAAC,OAAO;AAC/B,YAAM,OAAO,MAAM,MAAM,KAAK,OAAK,EAAE,OAAO,EAAE;AAC9C,aAAO,OAAO,KAAK,YAAY;AAAA,IAChC;AAAA;AAAA,IAGD,qBAAqB,CAAC,UAAU,CAAC,WAAW;AAC1C,aAAO,SAAS,MAAM,MAAM,OAAO,OAAK,EAAE,WAAW,MAAM,EAAE,SAAS,MAAM,MAAM,UAAU;AAAA,IAC7F;AAAA;AAAA,IAGD,kBAAkB,CAAC,UAAU,CAAC,WAAW;AACvC,aAAO,SAAS,MAAM,MAAM,OAAO,OAAK,EAAE,WAAW,MAAM,IAAI,MAAM;AAAA,IACtE;AAAA,EACF;AAAA;AAAA,EAGD,SAAS;AAAA;AAAA,IAEP,QAAQ,MAAM;AAEZ,YAAM,QAAQ,KAAK,MAAM,UAAU,OAAK,EAAE,OAAO,KAAK,EAAE;AAExD,UAAI,UAAU,IAAI;AAEhB,aAAK,MAAM,KAAK,EAAE,YAAY,IAAIA,cAAAA,QAAQ,KAAK,MAAM,KAAK,EAAE,SAAS,EAAE,IAAI,IAAIA,cAAO,QAAC,CAAC,CAAC,EAAE;MACnG,OAAa;AAEL,aAAK,MAAM,KAAK;AAAA,UACd,GAAG;AAAA,UACH,WAAW;AAAA,QACrB,CAAS;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGD,QAAQ,MAAM;AACZ,YAAM,QAAQ,KAAK,MAAM,UAAU,OAAK,EAAE,OAAO,KAAK,EAAE;AAExD,UAAI,UAAU,IAAI;AAEhB,YAAI,KAAK,MAAM,KAAK,EAAE,YAAY,GAAG;AACnC,eAAK,MAAM,KAAK,EAAE,YAAY,IAAIA,cAAAA,QAAQ,KAAK,MAAM,KAAK,EAAE,SAAS,EAAE,IAAI,IAAIA,cAAO,QAAC,CAAC,CAAC,EAAE;QACrG,OAAe;AAEL,eAAK,MAAM,OAAO,OAAO,CAAC;AAAA,QAC3B;AAAA,MACF;AAAA,IACF;AAAA;AAAA,IAGD,YAAY;AACVC,oBAAAA,MAAY,MAAA,OAAA,uBAAA,4BAA4B;AACxC,WAAK,QAAQ;IACd;AAAA;AAAA,IAGD,UAAU,MAAM;AACd,YAAM,QAAQ,KAAK,MAAM,UAAU,OAAK,EAAE,OAAO,KAAK,EAAE;AAExD,UAAI,UAAU,IAAI;AAEhB,YAAI,KAAK,QAAQ,KAAI;AACnB,eAAK,MAAM,OAAO,OAAO,CAAC;AAAA,QACpC,OAAe;AACL,eAAK,MAAM,KAAK,EAAE,YAAY,KAAK;AAAA,QACpC;AAAA,MACT,OAAa;AAEL,YAAI,KAAK,SAAS,KAAI;AAEpB,eAAK,MAAM,KAAK;AAAA,YACd,GAAG;AAAA,YACH,WAAW,KAAK;AAAA,UAC5B,CAAW;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACH,CAAC;;"}