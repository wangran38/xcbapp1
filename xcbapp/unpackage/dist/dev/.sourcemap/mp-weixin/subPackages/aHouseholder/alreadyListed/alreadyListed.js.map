{"version":3,"file":"alreadyListed.js","sources":["subPackages/aHouseholder/alreadyListed/alreadyListed.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNcYUhvdXNlaG9sZGVyXGFscmVhZHlMaXN0ZWRcYWxyZWFkeUxpc3RlZC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 分类导航 -->\r\n\t\t<scroll-view class=\"category-tabs\" scroll-x scroll-with-animation :scroll-left=\"scrollLeft\">\r\n\t\t\t<view class=\"tab-wrapper\">\r\n\t\t\t\t<view v-for=\"(category, index) in categories\" :key=\"index\"\r\n\t\t\t\t\t:class=\"['tab-item', activeCategory === category.value ? 'active' : '']\"\r\n\t\t\t\t\t@click=\"switchCategory(category.value, index)\">\r\n\t\t\t\t\t{{ category.label }}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 菜品列表 -->\r\n\t\t<scroll-view class=\"dish-list\" scroll-y :style=\"{height: scrollHeight + 'px'}\" @scrolltolower=\"changePage\">\r\n\t\t\t<view v-for=\"(dish, index) in dishes\" :key=\"dish.id\" class=\"dish-card\">\r\n\t\t\t\t<image class=\"dish-image\" :src=\"dish.imglogo\" mode=\"aspectFill\" ></image>\r\n\t\t\t\t<view class=\"dish-content\">\r\n\t\t\t\t\t<text class=\"dish-name\">{{ dish.goodsname }}</text>\r\n\t\t\t\t\t<text class=\"dish-price\">¥{{ dish.price }}</text>\r\n\t\t\t\t\t<text class=\"dish-stock\">库存: {{ dish.goodstotal }}{{ dish.unit }}</text>\r\n\t\t\t\t\t<button class=\"off-shelf-btn\" @click=\"handleOffShelf(dish.id)\">\r\n\t\t\t\t\t\t下架\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 空状态 -->\r\n\t\t\t<view v-if=\"!loading && dishes.length === 0\" class=\"empty-wrapper\">\r\n\t\t\t\t<image class=\"empty-image\" src=\"/static/empty.png\"></image>\r\n\t\t\t\t<text class=\"empty-text\">暂无上架商品</text>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tapi\r\n\t} from '@/api/index.js'\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tactiveCategory: 1,\r\n\t\t\t\tcategories: [{\r\n\t\t\t\t\t\tlabel: '自销',\r\n\t\t\t\t\t\tvalue: 1\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: '代提',\r\n\t\t\t\t\t\tvalue: 2\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: '批发',\r\n\t\t\t\t\t\tvalue: 3\r\n\t\t\t\t\t}\r\n\t\t\t\t],\r\n\t\t\t\tdishes: [\r\n\t\t\t\t\t\r\n\t\t\t\t],\r\n\t\t\t\tscrollHeight: 600,\r\n\t\t\t\tscrollLeft: 0,\r\n\t\t\t\tloading: true,\r\n\t\t\t\t\r\n\t\t\t\tqueryData:{\r\n\t\t\t\t\tispresale:2,\r\n\t\t\t\t\tpage:1,\r\n\t\t\t\t\tlimit:10,\r\n\t\t\t\t\tsellstatus:1 // 默认加载自销数据\r\n\t\t\t\t},\r\n\t\t\t\tisNoMore:false // 是否允许加载数据\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.loadData()\r\n\t\t\tthis.calcScrollHeight()\r\n\t\t},\r\n\t\twatch:{\r\n\t\t\tactiveCategory(newValue,oldValue){\r\n\t\t\t\tthis.isNoMore = false\r\n\t\t\t\tthis.dishes  = [] // 如果切换类型就清空原始数据\r\n\t\t\t\tthis.queryData.sellstatus = newValue\r\n\t\t\t\tthis.queryData.page = 1\r\n\t\t\t\tthis.loadData()\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinitQueryData(sellstatus = 1){\r\n\t\t\t\tthis.queryData = {\r\n\t\t\t\t\tpage:1,\r\n\t\t\t\t\tlimit:10,\r\n\t\t\t\t\tsellstatus:sellstatus\r\n\t\t\t\t},\r\n\t\t\t\tthis.isNoMore = false \r\n\t\t\t\tthis.dishes  = []\r\n\t\t\t\tconsole.log(this.queryData)\r\n\t\t\t},\r\n\t\t\tchangePage(){\r\n\t\t\t\tthis.queryData.page++\r\n\t\t\t\tthis.loadData()\r\n\t\t\t},\r\n\t\t\tasync loadData() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (!this.isNoMore){\r\n\t\t\t\t\t\tconst res = await api.presaleList(this.queryData)\r\n\t\t\t\t\t\tif (res.code == 200){\r\n\t\t\t\t\t\t\tthis.dishes = [...this.dishes,...res.data.listdata]\r\n\t\t\t\t\t\t\tthis.isNoMore = res.data.listdata.length <= this.queryData.limit ? true : false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(error)\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.loading = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tcalcScrollHeight() {\r\n\t\t\t\tconst systemInfo = uni.getSystemInfoSync()\r\n\t\t\t\tconst query = uni.createSelectorQuery().in(this)\r\n\t\t\t\tquery.select('.category-tabs').boundingClientRect()\r\n\t\t\t\tquery.exec(res => {\r\n\t\t\t\t\tconst tabHeight = res[0]?.height || 60\r\n\t\t\t\t\tthis.scrollHeight = systemInfo.windowHeight - tabHeight - 10\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\tswitchCategory(value, index) {\r\n\t\t\t\tthis.activeCategory = value\r\n\t\t\t\t// 计算滚动定位\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tconst query = uni.createSelectorQuery().in(this)\r\n\t\t\t\t\tquery.select(`.tab-item:nth-child(${index + 1})`).boundingClientRect()\r\n\t\t\t\t\tquery.exec(res => {\r\n\t\t\t\t\t\tif (res[0]) {\r\n\t\t\t\t\t\t\tthis.scrollLeft = res[0].left - 50\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// 下架菜品\r\n\t\t\tasync handleOffShelf(id) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await api.XiaShiCity({\r\n\t\t\t\t\t\tid,\r\n\t\t\t\t\t\tisshow: 1,\r\n\t\t\t\t\t\tispresale:1\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif (res.code == 200){\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '下架成功',\r\n\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.initQueryData(this.activeCategory)\r\n\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '下架失败',\r\n\t\t\t\t\t\t\ticon: 'error'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '操作失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\thandleImageError(dish) {\r\n\t\t\t\tdish.image = '/static/default-dish.png'\r\n\t\t\t},\r\n\r\n\t\t\tonRefresh() {\r\n\t\t\t\tthis.loadData()\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t}, 1000)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.container {\r\n\t\tbackground-color: #f8f8f8;\r\n\t\theight: 100vh;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.category-tabs {\r\n\t\tbackground: #fff;\r\n\t\tpadding: 20rpx 0;\r\n\t\twhite-space: nowrap;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.06);\r\n\r\n\t\t.tab-wrapper {\r\n\t\t\tdisplay: inline-flex;\r\n\t\t\tpadding: 0 30rpx;\r\n\t\t}\r\n\r\n\t\t.tab-item {\r\n\t\t\tposition: relative;\r\n\t\t\tpadding: 16rpx 40rpx;\r\n\t\t\tmargin-right: 40rpx;\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tcolor: #666;\r\n\t\t\ttransition: color 0.2s;\r\n\r\n\t\t\t&::after {\r\n\t\t\t\tcontent: '';\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tbottom: 0;\r\n\t\t\t\tleft: 50%;\r\n\t\t\t\twidth: 0;\r\n\t\t\t\theight: 4rpx;\r\n\t\t\t\tbackground: #007AFF;\r\n\t\t\t\ttransition: all 0.3s;\r\n\t\t\t}\r\n\r\n\t\t\t&.active {\r\n\t\t\t\tcolor: #007AFF;\r\n\t\t\t\tfont-weight: 500;\r\n\r\n\t\t\t\t&::after {\r\n\t\t\t\t\tleft: 0;\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.dish-list {\r\n\t\tpadding: 30rpx;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.dish-card {\r\n\t\tdisplay: flex;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 24rpx;\r\n\t\tmargin-bottom: 30rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.04);\r\n\r\n\t\t.dish-image {\r\n\t\t\twidth: 220rpx;\r\n\t\t\theight: 220rpx;\r\n\t\t\tborder-radius: 12rpx;\r\n\t\t\tflex-shrink: 0;\r\n\t\t\tbackground: #f5f5f5;\r\n\t\t}\r\n\r\n\t\t.dish-content {\r\n\t\t\tflex: 1;\r\n\t\t\tmargin-left: 24rpx;\r\n\t\t\tposition: relative;\r\n\t\t\tpadding-right: 160rpx;\r\n\r\n\t\t\t.dish-name {\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tline-height: 1.4;\r\n\t\t\t}\r\n\r\n\t\t\t.dish-price {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tcolor: #ff4444;\r\n\t\t\t\tfont-size: 36rpx;\r\n\t\t\t\tfont-weight: 600;\r\n\t\t\t\tmargin: 16rpx 0;\r\n\t\t\t}\r\n\r\n\t\t\t.dish-stock {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tfont-size: 26rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t}\r\n\r\n\t\t\t.off-shelf-btn {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tright: 0;\r\n\t\t\t\tbottom: 0;\r\n\t\t\t\tpadding: 0 40rpx;\r\n\t\t\t\theight: 64rpx;\r\n\t\t\t\tline-height: 64rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tbackground: #f8f8f8;\r\n\t\t\t\tcolor: #666;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\r\n\t\t\t\t&::after {\r\n\t\t\t\t\tborder: none;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&[disabled] {\r\n\t\t\t\t\topacity: 0.6;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.empty-wrapper {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 100rpx 0;\r\n\r\n\t\t.empty-image {\r\n\t\t\twidth: 280rpx;\r\n\t\t\theight: 280rpx;\r\n\t\t\topacity: 0.8;\r\n\t\t}\r\n\r\n\t\t.empty-text {\r\n\t\t\tcolor: #999;\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\tmargin-top: 20rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t/* 多行省略 */\r\n\t@mixin multiline-ellipsis($lines) {\r\n\t\tdisplay: -webkit-box;\r\n\t\t-webkit-box-orient: vertical;\r\n\t\t-webkit-line-clamp: $lines;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/subPackages/aHouseholder/alreadyListed/alreadyListed.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api"],"mappings":"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"}