{"version":3,"file":"user-edit.js","sources":["subPackages/settings/user-edit/user-edit.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNcc2V0dGluZ3NcdXNlci1lZGl0XHVzZXItZWRpdC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"me-container\">\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"avatar\">\r\n\t\t\t\t<view class=\"title\">头像</view>\r\n\t\t\t\t<view class=\"avatar-box\" @click=\"chooseImage\">\r\n\t\t\t\t\t<image :src=\"user.Headimgurl  || 'http://h5.xcbdsc.com/static/morentouxiang.jpg'\" class=\"avatar-image\" mode=\"aspectFill\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"name\">\r\n\t\t\t\t<view class=\"title\">昵称</view>\r\n\t\t\t\t<view class=\"name-item\">\r\n\t\t\t\t\t<input class=\"input-text\" type=\"text\" placeholder=\"请输入昵称\" v-model=\"user.nickname\" />\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"phone\">\r\n\t\t\t\t<view class=\"title\">电话</view>\r\n\t\t\t\t<view class=\"name-item\">\r\n\t\t\t\t\t<input class=\"input-text\" type=\"text\" placeholder=\"请输入电话\" v-model=\"user.phone\" />\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"sex\">\r\n\t\t\t\t<view class=\"title\">性别</view>\r\n\t\t\t\t<view class=\"name-item\">\r\n\t\t\t\t\t<!-- <input class=\"input-text\" type=\"number\" placeholder=\"请输入性别\" v-model=\"user.sex\" /> -->\r\n\t\t\t\t\t<picker class=\"input-text\" :range=\"sexOptions\" @change=\"handleSexChange\">\r\n\t\t\t\t\t\t<!-- <view class=\"picker\"> -->\r\n\t\t\t\t\t\t{{ sexOptions[user.sex] }}\r\n\t\t\t\t\t\t<!-- </view> -->\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<button class=\"submit\" @click=\"submitForm\" :disabled=\"isSubmitting\">\r\n\t\t\t\t\t\t\t提交\r\n\t\t\t</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tapi,UPLOAD_URL \r\n\t} from '@/api/index.js'; // 确保路径正确\r\n\timport {\r\n\t\tuseUpload\r\n\t} from \"@/hooks/useUpload\";\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tuser: {\r\n\t\t\t\t\tHeadimgurl: '',\r\n\t\t\t\t\tnickname: '',\r\n\t\t\t\t\tphone: '',\r\n\t\t\t\t\tsex: ''\r\n\t\t\t\t},\r\n\t\t\t\tsexOptions: ['未知', '男', '女'],\r\n\t\t\t\tisSubmitting: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tif (this.checkToken()){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:'/pages/login/login'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 从本地存储中获取 token\r\n\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\tif (!token) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请先登录',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// 从后端获取用户数据\r\n\t\t\tapi.getUserProfile(token)\r\n\t\t\t\t.then(response => {\r\n\t\t\t\t\tconsole.log('用户数据:', response.data);\r\n\t\t\t\t\tthis.user = response.data;\r\n\t\t\t\t\tthis.user.nickname = response.data.name;\r\n\t\t\t\t\tthis.user.sex = this.mapSexFromBackend(response.data.sex);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => {\r\n\t\t\t\t\tconsole.error('获取用户数据失败', error);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取用户数据失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 检查是否token存在，存在则已登陆\r\n\t\t\tcheckToken() {\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\tif (!token){\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t\treturn false\r\n\t\t\t},\r\n\t\t\thandleSexChange(e) {\r\n\t\t\t\tthis.user.sex = Number(e.detail.value); // 更新性别\r\n\t\t\t},\r\n\t\t\tmapSexFromBackend(sex) {\r\n\t\t\t\treturn sex === 2 ? 2 : (sex === 1 ? 1 : 0);\r\n\t\t\t},\r\n\t\t\tmapSexToBackend(sex) {\r\n\t\t\t\treturn sex === 2 ? 2 : (sex === 1 ? 1 : 0);\r\n\t\t\t},\r\n\t\t\t//头像\t\t\t\t\t\t\r\n\t\t\tchooseImage() {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['compressed','original'],\r\n\t\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// console.log(res.data.path);\r\n\t\t\t\t\t\tconst tempFilePaths = res.tempFilePaths;\r\n\t\t\t\t\t\tif (tempFilePaths.length > 0) {\r\n\t\t\t\t\t\t\tconsole.log(tempFilePaths);\r\n\t\t\t\t\t\t\tconst {upload,request} = useUpload({\r\n\t\t\t\t\t\t\t\tuploadPath: '/group1/upload',\r\n\t\t\t\t\t\t\t\ttempFilePaths: tempFilePaths[0],\r\n\t\t\t\t\t\t\t\tfile:res.tempFiles[0]\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tupload().then((res) => {\r\n\t\t\t\t\t\t\t\tvar obj = JSON.parse(res);\r\n\t\t\t\t\t\t\t\t// console.log(obj.data);\r\n\t\t\t\t\t\t\t\tthis.user.Headimgurl = UPLOAD_URL+obj.data.path\r\n\t\t\t\t\t\t\t})\t\t\r\n\t\t\t\t\t\t\t// api.uploadImage(tempFilePaths[0])\r\n\t\t\t\t\t\t\t// \t.then(data => {\r\n\t\t\t\t\t\t\t// \t\tthis.user.headimgurl = data.url; // 更新头像 URL\r\n\t\t\t\t\t\t\t// \t})\r\n\t\t\t\t\t\t\t// \t.catch(error => {\r\n\t\t\t\t\t\t\t// \t\tuni.showToast({\r\n\t\t\t\t\t\t\t// \t\t\ttitle: '上传失败',\r\n\t\t\t\t\t\t\t// \t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t\t\t// \t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\r\n\t\t\tsubmitForm() {\r\n\t\t\t\tthis.isSubmitting = true;\r\n\t\t\t\tapi.editUserProfile(this.user)\r\n\t\t\t\t\t.then(response => {\r\n\t\t\t\t\t\tconsole.log('修改成功', response);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '修改成功',\r\n\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tconsole.error('修改失败', error);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '修改失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.isSubmitting = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.me-container {\r\n\t\toverflow: hidden;\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0rpx 40rpx 0 40rpx;\r\n\t\tcolor: white;\r\n\t\tz-index: 1;\r\n\t\tbackground-color: #f8f8f8;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.content {\r\n\t\theight: 500rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground-color: white;\r\n\t\tcolor: black;\r\n\t\tpadding: 20rpx;\r\n\t\tflex: 5;\r\n\t}\r\n\r\n\t.name,\r\n\t.phone,\r\n\t.sex,\r\n\t.avatar {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t}\r\n\r\n\t.name-item {\r\n\t\theight: 100rpx;\r\n\t\twidth: 50%;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\t/* background-color: aqua; */\r\n\t}\r\n\r\n\t.avatar-box {\r\n\t\theight: 100rpx;\r\n\t\twidth: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tbox-sizing: border-box;\r\n\t\t/* background-color: aqua; */\r\n\t}\r\n\r\n\t.avatar-image {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tobject-fit: cover;\r\n\t\tborder-radius: 50%;\r\n\t}\r\n\r\n\t.title {\r\n\t\theight: 100rpx;\r\n\t\twidth: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 100rpx;\r\n\t\tfont-size: 34rpx;\r\n\t\tcolor: #666666;\r\n\t\t/* background-color: #007aff; */\r\n\t}\r\n\r\n\t.input-text {\r\n\t\theight: 80rpx;\r\n\t\twidth: 100%;\r\n\t\tcolor: black;\r\n\t\ttext-align: right;\r\n\t\tline-height: 80rpx;\r\n\t\tmargin-right: 20rpx;\r\n\t\t/* background-color: #007aff; */\r\n\t}\r\n\r\n\t.rigicon {\r\n\t\theight: 80rpx;\r\n\t\twidth: 50rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 80rpx;\r\n\t}\r\n\r\n\t.submit {\r\n\t\theight: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 80rpx;\r\n\t\tcolor: white;\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: 500;\r\n\t\tmargin: 20rpx 0;\r\n\t\tbackground-color: #007aff;\r\n\t\tborder-radius: 20rpx;\r\n\t}\r\n\t.submit[disabled] {\r\n\t\t\tcolor: #ccc; /* 提交按钮禁用时的颜色 */\r\n\t\t}\r\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/subPackages/settings/user-edit/user-edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api","useUpload","res","UPLOAD_URL"],"mappings":"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"}