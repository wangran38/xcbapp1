{"version":3,"file":"version.js","sources":["subPackages/settings/version/version.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNcc2V0dGluZ3NcdmVyc2lvblx2ZXJzaW9uLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"modern-update\">\n    <!-- 动态背景层 -->\n    <view class=\"background-wave\"></view>\n    \n    <!-- 主内容容器 -->\n    <view class=\"update-card\">\n      <!-- 头部图标 -->\n      <view class=\"header\">\n        <view class=\"icon-container\">\n          <image class=\"update-icon\" src=\"/static/rocket.svg\" mode=\"aspectFit\"></image>\n          <view class=\"shine-effect\"></view>\n        </view>\n      </view>\n\n      <!-- 版本信息 -->\n      <view class=\"version-info\">\n        <text class=\"version-label\">新版本</text>\n        <text class=\"version-number\">v{{ latestVersion }}</text>\n      </view>\n\n      <!-- 更新内容 -->\n      <scroll-view class=\"changelog\" scroll-y>\n        <view v-for=\"(item, index) in updateContent\" :key=\"index\" class=\"changelog-item\">\n          <image class=\"item-icon\" src=\"/static/check-circle.svg\"></image>\n          <text class=\"item-text\">{{ item }}</text>\n        </view>\n      </scroll-view>\n\n      <!-- 进度指示 -->\n      <view class=\"progress-container\" v-if=\"updating\">\n        <view class=\"progress-bar\" :style=\"{ width: downloadPercent + '%' }\">\n          <view class=\"progress-pulse\"></view>\n        </view>\n        <text v-if=\"updating\"  class=\"progress-text\">{{ progressPhrase }}</text>\n      </view>\n\n      <!-- 操作按钮 -->\n      <button class=\"update-button\" :disabled=\"updating\" @click=\"handleUpdate\">\n        {{ buttonLabel }}\n      </button>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\r\n\t// buttonLabel:'更新版本',\n      latestVersion: '2.0.0',\n      currentVersion: '1.0.0',\n      downloadPercent: 0,\n      updating: false,\n      updateContent: [\n        '关闭线上调试',\n      ],\r\n\t  downloading:false\n    }\n  },\n  computed: {\r\n\t  buttonLabel() {\r\n\t        return this.updating ? \r\n\t          `更新中 ${this.downloadPercent}%` : \r\n\t          '立即体验新版本'\r\n\t      },\r\n\t  progressPhrase() {\r\n\t        const phrases = [\r\n\t          '正在连接更新服务器...',\r\n\t          '发现可用更新包',\r\n\t          '正在优化性能模块',\r\n\t          '校验文件完整性',\r\n\t          '准备就绪'\r\n\t        ]\r\n\t        return phrases[Math.min(Math.floor(this.downloadPercent/25), 4)]\r\n\t      },\n    contentList() {\n      return this.updateContent.filter(Boolean).map(item => item.trim())\n    },\n    btnText() {\n      if (this.updating) {\n        return this.downloadPercent === 100 ? '安装中...' : `下载中 ${this.downloadPercent}%`\n      }\n      return '立即更新'\n    },\n  },\n  mounted() {\n    // #ifdef MP-WEIXIN\n    this.initUpdateManager()\n    // #endif\n  },\n  methods: {\n    // 初始化更新管理器\n    initUpdateManager() {\n      if (!wx.canIUse('getUpdateManager')) return\n      \n      const updateManager = wx.getUpdateManager()\n      \n      updateManager.onCheckForUpdate(res => {\n        if (res.hasUpdate) {\n          this.showUpdatePage = true\n          this.registerListeners(updateManager)\n        }\n      })\n    },\n\n    // 注册更新监听器\n    registerListeners(manager) {\n      // 下载进度事件\n      manager.onUpdateReady(() => {\n        this.downloadPercent = 100\n        this.applyUpdate(manager)\n      })\n\n      // 下载失败处理\n      manager.onUpdateFailed(() => {\n        uni.showToast({\n          title: '更新失败',\n          icon: 'none',\n          duration: 2000\n        })\n        this.updating = false\n      })\n\n      // 下载进度模拟（小程序无真实进度）\n      this.simulateProgress()\n    },\n\n    // 处理更新操作\n    handleUpdate() {\n      this.updating = true\r\n\t  this.simulateProgress()\n      wx.showLoading({\n        title: '准备更新',\n        mask: true\n      })\n      \n      // 触发强制更新\n      if (this.downloadPercent === 100) {\n        this.applyUpdate(wx.getUpdateManager())\n      }\n    },\n\n    // 应用更新\n    applyUpdate(manager) {\n      uni.showModal({\n        title: '更新提示',\n        content: '新版本已就绪，立即重启应用？',\n        confirmText: '立即重启',\n        success: res => {\n          if (res.confirm) {\n            manager.applyUpdate()\n          }\n        },\n        complete: () => {\n          this.updating = false\n          wx.hideLoading()\n        }\n      })\n    },\n\n    // 模拟进度（因小程序无真实进度事件）\n    simulateProgress() {\n      let current = 0\n      const timer = setInterval(() => {\n        if (current < 95) {\n          current += Math.floor(Math.random() * 15 + 5)\n          this.downloadPercent = Math.min(current, 95)\n        } else {\n          clearInterval(timer)\n        }\n      }, 1000)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.modern-update {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  z-index: 9999;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  overflow: hidden;\n}\n\n.background-wave {\n  position: absolute;\n  width: 200%;\n  height: 200%;\n  background: rgba(255,255,255,0.1);\n  border-radius: 40%;\n  animation: wave 20s infinite linear;\n}\n\n@keyframes wave {\n  0% { transform: rotate(0deg) translateY(50px); }\n  100% { transform: rotate(360deg) translateY(50px); }\n}\n\n.update-card {\n  background: rgba(255,255,255,0.95);\n  border-radius: 24px;\n  padding: 40rpx;\n  width: 85%;\n  max-width: 600rpx;\n  box-shadow: 0 10px 30px rgba(0,0,0,0.15);\n  backdrop-filter: blur(10px);\n}\n\n.header {\n  position: relative;\n  margin-bottom: 40rpx;\n}\n\n.icon-container {\n  position: relative;\n  width: 120rpx;\n  height: 120rpx;\n  margin: 0 auto;\n  \n  .update-icon {\n    width: 100%;\n    height: 100%;\n    filter: drop-shadow(0 4px 6px rgba(102, 126, 234, 0.3));\n  }\n  \n  .shine-effect {\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    width: 140%;\n    height: 140%;\n    background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, transparent 60%);\n    animation: shine 2s ease-in-out infinite;\n  }\n}\n\n@keyframes shine {\n  0%, 100% { opacity: 0.4; transform: scale(0.9); }\n  50% { opacity: 0.8; transform: scale(1.1); }\n}\n\n.version-info {\n  text-align: center;\n  margin-bottom: 40rpx;\n  \n  .version-label {\n    display: block;\n    color: #667eea;\n    font-size: 28rpx;\n    letter-spacing: 2px;\n    margin-bottom: 12rpx;\n  }\n  \n  .version-number {\n    font-size: 48rpx;\n    font-weight: 700;\n    color: #2d3748;\n  }\n}\n\n.changelog {\n  max-height: 300rpx;\n  margin-bottom: 40rpx;\n  \n  &-item {\n    display: flex;\n    align-items: center;\n    padding: 20rpx 0;\n    border-bottom: 1px solid rgba(0,0,0,0.05);\n    \n    .item-icon {\n      width: 36rpx;\n      height: 36rpx;\n      margin-right: 20rpx;\n    }\n    \n    .item-text {\n      font-size: 28rpx;\n      color: #4a5568;\n      line-height: 1.4;\n    }\n  }\n}\n\n.progress-container {\n  margin: 40rpx 0;\n  \n  .progress-bar {\n    height: 8px;\n    background: #667eea;\n    border-radius: 4px;\n    position: relative;\n    transition: width 0.3s ease;\n    \n    .progress-pulse {\n      position: absolute;\n      right: -8px;\n      top: -4px;\n      width: 16px;\n      height: 16px;\n      background: #667eea;\n      border-radius: 50%;\n      animation: pulse 1.5s infinite;\n    }\n  }\n  \n  .progress-text {\n    display: block;\n    text-align: center;\n    font-size: 24rpx;\n    color: #718096;\n    margin-top: 20rpx;\n  }\n}\n\n@keyframes pulse {\n  0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }\n  70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }\n  100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }\n}\n\n.update-button {\n  background: linear-gradient(45deg, #667eea, #764ba2);\n  color: white;\n  height: 96rpx;\n  line-height: 96rpx;\n  border-radius: 48rpx;\n  font-size: 32rpx;\n  font-weight: 500;\n  position: relative;\n  overflow: hidden;\n  transition: all 0.3s ease;\n  \n  &::after {\n    border: none;\n  }\n  \n  &:active {\n    transform: scale(0.98);\n  }\n  \n  .loading-icon {\n    width: 40rpx;\n    height: 40rpx;\n    margin-right: 16rpx;\n    animation: spin 1s linear infinite;\n  }\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/subPackages/settings/version/version.vue'\nwx.createPage(MiniProgramPage)"],"names":["wx","uni"],"mappings":";;;AA8CA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA;AAAA,MAEL,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,iBAAiB;AAAA,MACjB,UAAU;AAAA,MACV,eAAe;AAAA,QACb;AAAA,MACD;AAAA,MACJ,aAAY;AAAA,IACX;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACT,cAAc;AACR,aAAO,KAAK,WACV,OAAO,KAAK,eAAe,MAC3B;AAAA,IACH;AAAA,IACL,iBAAiB;AACX,YAAM,UAAU;AAAA,QACd;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AACA,aAAO,QAAQ,KAAK,IAAI,KAAK,MAAM,KAAK,kBAAgB,EAAE,GAAG,CAAC,CAAC;AAAA,IAChE;AAAA,IACJ,cAAc;AACZ,aAAO,KAAK,cAAc,OAAO,OAAO,EAAE,IAAI,UAAQ,KAAK,MAAM;AAAA,IAClE;AAAA,IACD,UAAU;AACR,UAAI,KAAK,UAAU;AACjB,eAAO,KAAK,oBAAoB,MAAM,WAAW,OAAO,KAAK,eAAe;AAAA,MAC9E;AACA,aAAO;AAAA,IACR;AAAA,EACF;AAAA,EACD,UAAU;AAER,SAAK,kBAAkB;AAAA,EAExB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,oBAAoB;AAClB,UAAI,CAACA,cAAE,KAAC,QAAQ,kBAAkB;AAAG;AAErC,YAAM,gBAAgBA,cAAE,KAAC,iBAAiB;AAE1C,oBAAc,iBAAiB,SAAO;AACpC,YAAI,IAAI,WAAW;AACjB,eAAK,iBAAiB;AACtB,eAAK,kBAAkB,aAAa;AAAA,QACtC;AAAA,OACD;AAAA,IACF;AAAA;AAAA,IAGD,kBAAkB,SAAS;AAEzB,cAAQ,cAAc,MAAM;AAC1B,aAAK,kBAAkB;AACvB,aAAK,YAAY,OAAO;AAAA,OACzB;AAGD,cAAQ,eAAe,MAAM;AAC3BC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,UACN,UAAU;AAAA,SACX;AACD,aAAK,WAAW;AAAA,OACjB;AAGD,WAAK,iBAAiB;AAAA,IACvB;AAAA;AAAA,IAGD,eAAe;AACb,WAAK,WAAW;AACnB,WAAK,iBAAiB;AACnBD,oBAAAA,KAAG,YAAY;AAAA,QACb,OAAO;AAAA,QACP,MAAM;AAAA,OACP;AAGD,UAAI,KAAK,oBAAoB,KAAK;AAChC,aAAK,YAAYA,mBAAG,kBAAkB;AAAA,MACxC;AAAA,IACD;AAAA;AAAA,IAGD,YAAY,SAAS;AACnBC,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,aAAa;AAAA,QACb,SAAS,SAAO;AACd,cAAI,IAAI,SAAS;AACf,oBAAQ,YAAY;AAAA,UACtB;AAAA,QACD;AAAA,QACD,UAAU,MAAM;AACd,eAAK,WAAW;AAChBD,wBAAAA,KAAG,YAAY;AAAA,QACjB;AAAA,OACD;AAAA,IACF;AAAA;AAAA,IAGD,mBAAmB;AACjB,UAAI,UAAU;AACd,YAAM,QAAQ,YAAY,MAAM;AAC9B,YAAI,UAAU,IAAI;AAChB,qBAAW,KAAK,MAAM,KAAK,OAAS,IAAE,KAAK,CAAC;AAC5C,eAAK,kBAAkB,KAAK,IAAI,SAAS,EAAE;AAAA,eACtC;AACL,wBAAc,KAAK;AAAA,QACrB;AAAA,MACD,GAAE,GAAI;AAAA,IACT;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;AC7KA,GAAG,WAAW,eAAe;"}