{"version":3,"file":"poster.js","sources":["components/poster.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTov5bCP56iL5bqP6L2sYXBwL3hjYmFwcC9jb21wb25lbnRzL3Bvc3Rlci52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 画布宽高用动态px，确保在所有设备上可见 -->\n\t\t<canvas \n\t\t\tcanvas-id=\"pureCanvas\" \n\t\t\t:style=\"{width: canvasWidth + 'px', height: canvasHeight + 'px'}\"\n\t\t\tclass=\"canvas\"\n\t\t></canvas>\n\t\t<button @click=\"saveCanvasImage\" class=\"save-btn\">\n\t\t\t保存图片到相册\n\t\t</button>\n\t</view>\n</template>\n\n<script>\nimport { api } from '@/api/index.js'\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tscene: null,\n\t\t\tcanvasWidth: 300,  // 默认画布宽度（px）\n\t\t\tcanvasHeight: 220, // 默认画布高度（px）\n\t\t\tscale: 1,          // 缩放比例（基于屏幕宽度）\n\t\t};\n\t},\n\tprops: {\n\t\tname: {\n\t\t\ttype: String,\n\t\t\tdefault: '无人测试'\n\t\t}\n\t},\n\tonLoad() {\n\t\t// 1. 获取屏幕信息计算缩放比例\n\t\tconst { windowWidth } = uni.getSystemInfoSync()\n\t\t// 以屏幕宽度的80%作为画布宽度（确保在各种屏幕上都能显示完整）\n\t\tthis.canvasWidth = Math.floor(windowWidth * 0.8)\n\t\t// 保持宽高比 5:4（根据内容调整，确保不拉伸）\n\t\tthis.canvasHeight = Math.floor(this.canvasWidth * 0.73)\n\t\t// 计算缩放比例（以300px为基准设计稿）\n\t\tthis.scale = this.canvasWidth / 300\n\t},\n\tasync onReady() {\n\t\t// 2. 确保二维码加载成功后再绘制\n\t\ttry {\n\t\t\tconst data = await api.getqrcode({})\r\n\t\t\t// console.log(data.data)\r\n\t\t\t// 将用户id传回父组件\r\n\t\t\tthis.$emit('initLoad',data.data.userid)\n\t\t\tthis.scene = data.data.fileURL\n\t\t\t// 延迟绘制，确保DOM渲染完成\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.drawPureCanvas()\n\t\t\t}, 100)\n\t\t} catch (err) {\n\t\t\tconsole.error('获取二维码失败：', err)\n\t\t\tuni.showToast({ title: '二维码加载失败', icon: 'none' })\n\t\t}\n\t},\n\tmethods: {\n\t\t// 适配尺寸：将设计稿尺寸（基于300px宽度）转换为实际尺寸\n\t\tadapt(size) {\n\t\t\treturn Math.floor(size * this.scale)\n\t\t},\n\n\t\t// 保存图片逻辑\n\t\tdoSaveImage() {\n\t\t\tuni.canvasToTempFilePath({\n\t\t\t\tcanvasId: 'pureCanvas',\n\t\t\t\twidth: this.canvasWidth,\n\t\t\t\theight: this.canvasHeight,\n\t\t\t\tdestWidth: this.canvasWidth * 3, // 高清输出\n\t\t\t\tdestHeight: this.canvasHeight * 3,\r\n\t\t\t\tquality:1,\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tuni.saveImageToPhotosAlbum({\n\t\t\t\t\t\tfilePath: res.tempFilePath,\n\t\t\t\t\t\tsuccess: () => uni.showToast({ title: '保存成功', icon: 'success' }),\n\t\t\t\t\t\tfail: () => uni.showToast({ title: '保存失败', icon: 'none' })\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tfail: () => uni.showToast({ title: '生成图片失败', icon: 'none' })\n\t\t\t}, this)\n\t\t},\n\n\t\tsaveCanvasImage() {\n\t\t\tuni.getSetting({\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (!res.authSetting['scope.writePhotosAlbum']) {\n\t\t\t\t\t\tuni.authorize({\n\t\t\t\t\t\t\tscope: 'scope.writePhotosAlbum',\n\t\t\t\t\t\t\tsuccess: () => this.doSaveImage(),\n\t\t\t\t\t\t\tfail: () => {\n\t\t\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\t\t\ttitle: '提示',\n\t\t\t\t\t\t\t\t\tcontent: '需要开启保存图片权限',\n\t\t\t\t\t\t\t\t\tsuccess: (modalRes) => modalRes.confirm && uni.openSetting()\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.doSaveImage()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\t// 加载图片为本地路径\n\t\tloadImageUrl(url) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tuni.getImageInfo({\n\t\t\t\t\tsrc: url,\n\t\t\t\t\tsuccess: (res) => resolve(res.path),\n\t\t\t\t\tfail: (err) => reject(`图片加载失败：${err.errMsg}`)\n\t\t\t\t})\n\t\t\t})\n\t\t},\n\n\t\t// 绘制圆角矩形\n\t\tdrawRoundRect(ctx, x, y, w, h, r) {\n\t\t\tctx.beginPath()\n\t\t\tctx.arc(x + r, y + r, r, Math.PI, Math.PI * 1.5)\n\t\t\tctx.arc(x + w - r, y + r, r, Math.PI * 1.5, Math.PI * 2)\n\t\t\tctx.arc(x + w - r, y + h - r, r, 0, Math.PI * 0.5)\n\t\t\tctx.arc(x + r, y + h - r, r, Math.PI * 0.5, Math.PI)\n\t\t\tctx.closePath()\n\t\t},\n\n\t\tasync drawPureCanvas() {\n\t\t\ttry {\n\t\t\t\tconst ctx = uni.createCanvasContext('pureCanvas', this)\n\t\t\t\t\n\t\t\t\t// 1. 绘制背景（占满整个画布，确保可见）\n\t\t\t\tconst gradient = ctx.createLinearGradient(0, 0, 0, this.canvasHeight)\n\t\t\t\tgradient.addColorStop(0, '#409EFF')\n\t\t\t\tgradient.addColorStop(1, '#B37EF1')\n\t\t\t\tctx.setFillStyle(gradient)\n\t\t\t\tctx.fillRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n\t\t\t\t// 2. 绘制标题（确保在画布顶部可见）\n\t\t\t\tctx.setFillStyle('#FFFFFF')\n\t\t\t\tctx.setFontSize(this.adapt(18)) // 设计稿18px，按比例缩放\n\t\t\t\tconst titleY = this.adapt(30) // 距离顶部30px（设计稿）\n\t\t\t\tctx.fillText('农链天下', this.adapt(20), titleY)\n\n\t\t\t\t// 3. 绘制邀请语（标题下方）\n\t\t\t\tctx.setFontSize(this.adapt(12))\n\t\t\t\tconst descY = this.adapt(60) // 距离顶部60px\n\t\t\t\tctx.fillText('我在这个平台发现了好东西，邀请你一起加入～', this.adapt(20), descY)\n\n\t\t\t\t// 4. 绘制白色卡片（确保在画布中间区域）\n\t\t\t\tconst cardX = this.adapt(20) // 左边距20px\n\t\t\t\tconst cardY = this.adapt(80) // 距离顶部80px\n\t\t\t\tconst cardWidth = this.canvasWidth - this.adapt(40) // 左右边距各20px\n\t\t\t\tconst cardHeight = this.adapt(90) // 高度90px\n\t\t\t\tconst cornerRadius = this.adapt(8) // 圆角8px\n\n\t\t\t\tctx.setFillStyle('#FFFFFF')\n\t\t\t\tthis.drawRoundRect(ctx, cardX, cardY, cardWidth, cardHeight, cornerRadius)\n\t\t\t\tctx.fill()\n\n\t\t\t\t// 5. 绘制卡片内文字（卡片上方区域）\n\t\t\t\tctx.setFillStyle('#333333')\n\t\t\t\tctx.setFontSize(this.adapt(12))\n\t\t\t\tconst cardTitleY = cardY + this.adapt(30) // 卡片内上边距30px\n\t\t\t\tctx.fillText('邀请你加入\"农链天下\"', cardX + this.adapt(20), cardTitleY)\n\n\t\t\t\tconst cardDescY = cardY + this.adapt(55) // 第二行文字\n\t\t\t\tctx.fillText('微信长按识别二维码', cardX + this.adapt(20), cardDescY)\n\n\t\t\t\t// 6. 绘制二维码（卡片右侧，确保不超出画布）\n\t\t\t\tif (!this.scene) throw new Error('二维码地址为空')\n\t\t\t\tconst imgPath = await this.loadImageUrl(this.scene)\n\t\t\t\tconst qrSize = this.adapt(70) // 二维码尺寸70px\n\t\t\t\t// 二维码位置：右边距20px，与卡片垂直居中\n\t\t\t\tconst qrX = this.canvasWidth - this.adapt(20) - qrSize\n\t\t\t\tconst qrY = cardY + (cardHeight - qrSize) / 2\n\n\t\t\t\tctx.drawImage(imgPath, qrX, qrY, qrSize, qrSize)\n\n\t\t\t\t// 7. 执行绘制（关键：必须调用draw()才会显示）\n\t\t\t\tctx.draw()\n\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('绘制失败：', err)\n\t\t\t\tuni.showToast({ title: '绘制失败', icon: 'none' })\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<style scoped>\n.container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tpadding: 20rpx;\n}\n.canvas {\n\tbackground-color: #f5f5f5; /* 临时背景色，方便确认画布是否显示 */\n}\n.save-btn {\n\tmargin-top: 20rpx;\n\tpadding: 10px 20px;\n\tbackground: #409EFF;\n\tcolor: white;\n\tborder-radius: 4px;\n}\n</style>","import Component from 'E:/小程序转app/xcbapp/components/poster.vue'\nwx.createComponent(Component)"],"names":["uni","api"],"mappings":"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"}