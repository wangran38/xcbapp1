{"version":3,"file":"usePage.js","sources":["hooks/usePage.js"],"sourcesContent":["export default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tpage: 1,\r\n\t\t\tlimit: 10,\r\n\t\t\ttotalnum: 0,\r\n\t\t\tpageData: [],\r\n\t\t\tpageLoading: false,\r\n\t\t\thasMore: true,\r\n\t\t\tsearchParams: {}\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tqueryParams() {\r\n\t\t\tconst filteredSearchParams = Object.fromEntries(\r\n\t\t\t\tObject.entries(this.searchParams).filter(([key, value]) => value !== '')\r\n\t\t\t);\r\n\t\t\treturn {\r\n\t\t\t\tpage: this.page,\r\n\t\t\t\tlimit: this.limit,\r\n\t\t\t\tisshow: 1,\r\n\t\t\t\t...filteredSearchParams\r\n\t\t\t};\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync loadPageData() {\r\n\t\t\tif (!this.hasMore || this.pageLoading) return;\r\n\t\t\tthis.pageLoading = true;\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await this.fetchData(this.queryParams);\r\n\t\t\t\tthis.querySuccess(response);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.handleFetchError(error);\r\n\t\t\t} finally {\r\n\t\t\t\tthis.pageLoading = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 这个方法会被重写\r\n\t\tasync fetchData(params) {\r\n\t\t\t// throw new Error('fetchData 方法未实现');\r\n\t\t},\r\n\r\n\t\t// 检测还有没有下一页\r\n\t\tquerySuccess(data) {\r\n\t\t\tif (data?.listdata) {\r\n\t\t\t\tthis.pageData = this.page === 1 ? data.listdata : this.pageData.concat(data.listdata);\r\n\t\t\t\tthis.totalnum = data.totalnum || 0;\r\n\t\t\t\tthis.hasMore = this.pageData.length < this.totalnum;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * 分页加载\r\n\t\t */\r\n\t\thandleScrollToLower() {\r\n\t\t\tif (!this.pageLoading && this.hasMore) {\r\n\t\t\t\tthis.page += 1;\r\n\t\t\t\tthis.loadPageData();\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleFetchError(error) {\r\n\t\t\tconsole.error('Error loading data:', error);\r\n\t\t},\r\n\r\n\t\t// 初始化\r\n\t\tresetPagination() {\r\n\t\t\tthis.page = 1;\r\n\t\t\tthis.pageData = [];\r\n\t\t\tthis.totalnum = 0;\r\n\t\t\tthis.hasMore = true;\r\n\t\t},\r\n\t\treloadData() {\r\n\t\t\tthis.resetPagination();\r\n\t\t\tthis.loadPageData();\r\n\t\t}\r\n\t}\r\n}"],"names":["uni"],"mappings":";;AAAA,MAAe,UAAA;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,MAAM;AAAA,MACN,OAAO;AAAA,MACP,UAAU;AAAA,MACV,UAAU,CAAE;AAAA,MACZ,aAAa;AAAA,MACb,SAAS;AAAA,MACT,cAAc,CAAE;AAAA,IACnB;AAAA,EACE;AAAA,EACD,UAAU;AAAA,IACT,cAAc;AACb,YAAM,uBAAuB,OAAO;AAAA,QACnC,OAAO,QAAQ,KAAK,YAAY,EAAE,OAAO,CAAC,CAAC,KAAK,KAAK,MAAM,UAAU,EAAE;AAAA,MAC3E;AACG,aAAO;AAAA,QACN,MAAM,KAAK;AAAA,QACX,OAAO,KAAK;AAAA,QACZ,QAAQ;AAAA,QACR,GAAG;AAAA,MACP;AAAA,IACG;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACR,MAAM,eAAe;AACpB,UAAI,CAAC,KAAK,WAAW,KAAK;AAAa;AACvC,WAAK,cAAc;AACnB,UAAI;AACH,cAAM,WAAW,MAAM,KAAK,UAAU,KAAK,WAAW;AACtD,aAAK,aAAa,QAAQ;AAAA,MAC1B,SAAQ,OAAO;AACf,aAAK,iBAAiB,KAAK;AAAA,MAC/B,UAAa;AACT,aAAK,cAAc;AAAA,MACnB;AAAA,IACD;AAAA;AAAA,IAED,MAAM,UAAU,QAAQ;AAAA,IAEvB;AAAA;AAAA,IAGD,aAAa,MAAM;AAClB,UAAI,6BAAM,UAAU;AACnB,aAAK,WAAW,KAAK,SAAS,IAAI,KAAK,WAAW,KAAK,SAAS,OAAO,KAAK,QAAQ;AACpF,aAAK,WAAW,KAAK,YAAY;AACjC,aAAK,UAAU,KAAK,SAAS,SAAS,KAAK;AAAA,MAC3C;AAAA,IACD;AAAA;AAAA;AAAA;AAAA,IAKD,sBAAsB;AACrB,UAAI,CAAC,KAAK,eAAe,KAAK,SAAS;AACtC,aAAK,QAAQ;AACb,aAAK,aAAY;AAAA,MACjB;AAAA,IACD;AAAA,IACD,iBAAiB,OAAO;AACvBA,oBAAc,MAAA,MAAA,SAAA,0BAAA,uBAAuB,KAAK;AAAA,IAC1C;AAAA;AAAA,IAGD,kBAAkB;AACjB,WAAK,OAAO;AACZ,WAAK,WAAW;AAChB,WAAK,WAAW;AAChB,WAAK,UAAU;AAAA,IACf;AAAA,IACD,aAAa;AACZ,WAAK,gBAAe;AACpB,WAAK,aAAY;AAAA,IACjB;AAAA,EACD;AACF;;"}