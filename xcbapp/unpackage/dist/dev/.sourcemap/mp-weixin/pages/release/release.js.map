{"version":3,"file":"release.js","sources":["pages/release/release.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVsZWFzZS9yZWxlYXNlLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"me-container\">\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"name\">\r\n\t\t\t\t<text class=\"title\">菜名</text>\r\n\t\t\t\t<view class=\"item\">\r\n\t\t\t\t\t<view class=\"picture\">\r\n\t\t\t\t\t\t<input class=\"input-text\" type=\"text\" placeholder=\"请输入菜名\" v-model=\"goodsname\" />\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\r\n\r\n\t\t\t<view class=\"price\">\r\n\t\t\t\t<text class=\"title\">分类</text>\r\n\t\t\t\t<view class=\"item\">\r\n\t\t\t\t\t<picker class=\"picker\" :range=\"pickerRange\" :value=\"selectedCategoryIndex\"\r\n\t\t\t\t\t\t@change=\"onCategoryChange\">\r\n\t\t\t\t\t\t<view class=\"picker-text\">{{ pickerRange[selectedCategoryIndex] }}</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"img\" @tap=\"uploadcuisine\">\r\n\t\t\t\t<text class=\"title\">图片</text>\r\n\t\t\t\t<view class=\"item\">\r\n\t\t\t\t\t<view class=\"picture\">\r\n\t\t\t\t\t\t<view v-if=\"!imglogo\">请上传图片</view>\r\n\t\t\t\t\t\t<image v-else :src=\"imglogo\" class=\"uploaded-image\" mode=\"aspectFit\"></image>\r\n\t\t\t\t\t\t<!-- {{ imageUploaded ? '已上传' : '请上传图片' }} -->\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<uni-icons class=\"rigicon\" type=\"right\" size=\"14\" color=\"rgb(229, 229, 229)\"></uni-icons>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\t\t\t<view class=\"submit\" @tap=\"submit\">\r\n\t\t\t\t提交\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<text style=\"color: red;margin-top: 30rpx;font-size: 30rpx;\">注意：添加菜品后要在菜品列表里面选择上架</text>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tapi,\r\n\t\tUPLOAD_URL\r\n\t} from '../../api/index.js';\r\n\timport {\r\n\t\tuseUpload,\r\n\t\tcompressPictures\r\n\t} from \"@/hooks/useUpload\"\r\n\timport Compressor from 'compressorjs';\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tImage:'',\r\n\t\t\t\tgoodsname: '',\r\n\t\t\t\tcategory_id: '',\r\n\t\t\t\t// price: '',\r\n\t\t\t\timageUploaded: false, // 图片上传状态\r\n\t\t\t\timglogo: '', // 存储图片地址\r\n\t\t\t\tcategories: [],\r\n\t\t\t\tpickerRange: [],\r\n\t\t\t\tselectedCategoryIndex: 0,\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.fetchCategories();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t\r\n\t\t\t// 返回上一页\r\n\t\t\tasync customizeBack() {\r\n\t\t\t\tlet canNavBack = await getCurrentPages()\r\n\t\t\t\tif (canNavBack && canNavBack.length > 1) {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t} else {\r\n\t\t\t\t\thistory.back();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 请求菜品分类数据\r\n\t\t\tfetchCategories() {\r\n\t\t\t\tapi.cglist().then(res => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\t// 获取分类数据\r\n\t\t\t\t\t\tconst categories = res.data.listdata.map(item => ({\r\n\t\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\t\tcontent: item.content\r\n\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t// 存储分类数据\r\n\t\t\t\t\t\tthis.categories = categories;\r\n\t\t\t\t\t\t// 初始化 picker 的范围数据，包括默认提示项\r\n\t\t\t\t\t\tthis.pickerRange = ['请选择分类', ...categories.map(category => category.content)];\r\n\t\t\t\t\t\tif (categories.length > 0) {\r\n\t\t\t\t\t\t\tthis.category_id = categories[0].id; // 默认选择第一个分类\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: res.message || '获取分类失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取分类失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t// 上传菜品图片\r\n\t\t\tuploadcuisine() {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['compressed', 'original'],\r\n\t\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\t\tconst tempFilePaths = res.tempFilePaths;\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\tif (tempFilePaths.length > 0) {\r\n\t\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\t\tupload,\r\n\t\t\t\t\t\t\t\trequest\r\n\t\t\t\t\t\t\t} = useUpload({\r\n\t\t\t\t\t\t\t\tuploadPath: '/group1/upload',\r\n\t\t\t\t\t\t\t\tfile: res.tempFiles[0],  // 传输文件对象\r\n\t\t\t\t\t\t\t\ttempFilePaths: tempFilePaths[0] // 传输文件路径\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tupload().then((res) => {\r\n\t\t\t\t\t\t\t\tvar obj = JSON.parse(res);\r\n\t\t\t\t\t\t\t\tthis.imglogo = UPLOAD_URL + obj.data.path\r\n\t\t\t\t\t\t\t\tthis.isImageSelected = true;\r\n\t\t\t\t\t\t\t\tthis.imageUploaded = true; // 更新图片上传状态\r\n\t\t\t\t\t\t\t})\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t// api.uploadImage(tempFilePaths[0])\r\n\t\t\t\t\t\t\t// \t.then(data => {\r\n\t\t\t\t\t\t\t// \t\tthis.user.headimgurl = data.url; // 更新头像 URL\r\n\t\t\t\t\t\t\t// \t})\r\n\t\t\t\t\t\t\t// \t.catch(error => {\r\n\t\t\t\t\t\t\t// \t\tuni.showToast({\r\n\t\t\t\t\t\t\t// \t\t\ttitle: '上传失败',\r\n\t\t\t\t\t\t\t// \t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t\t\t// \t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonCategoryChange(e) {\r\n\t\t\t\tconst selectedIndex = e.detail.value;\r\n\t\t\t\tthis.selectedCategoryIndex = selectedIndex;\r\n\r\n\t\t\t\t// 检查用户是否选择了有效的分类（跳过第一个默认项）\r\n\t\t\t\tif (selectedIndex > 0) {\r\n\t\t\t\t\tthis.category_id = this.categories[selectedIndex - 1].id; // -1 是因为 `pickerRange` 的第一项是提示\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.category_id = ''; // 用户选择了默认提示项，重置 `category_id`\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsubmit() {\r\n\t\t\t\tconsole.log(this.goodsname,this.category_id)\r\n\t\t\t\tif (!this.goodsname || !this.category_id || !this.imglogo) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请填写完整信息',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapi.addgoods({\r\n\t\t\t\t\tcategory_id: this.category_id,\r\n\t\t\t\t\tgoodsname: this.goodsname,\r\n\t\t\t\t\timglogo: this.imglogo, // 直接传递图片地址\r\n\t\t\t\t\t// price: parseFloat(this.price)\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '菜品添加成功',\r\n\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\tduration: 1000\r\n\t\t\t\t\t\t}).then(() => {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t// 是否继续添加菜品\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: \"是否继续添加菜品\",\r\n\t\t\t\t\t\t\t\t\tcancelText: '否',\r\n\t\t\t\t\t\t\t\t\tconfirmText: '是',\r\n\t\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"继续添加\")\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.customizeBack()\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t// 蔬菜名字清空\r\n\t\t\t\t\t\tthis.goodsname = '';\r\n\t\t\t\t\t\tthis.imglogo = '';\r\n\t\t\t\t\t\tthis.imageUploaded = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: res.msg || '添加失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(err => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '添加失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.me-container {\r\n\t\toverflow: hidden;\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0rpx 40rpx 0 40rpx;\r\n\t\tcolor: white;\r\n\t\tz-index: 1;\r\n\t\tbackground-color: #f8f8f8;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.content {\r\n\t\tmargin-top: 30rpx;\r\n\t\tbackground-color: white;\r\n\t\tflex: 4;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tpadding: 0 10rpx;\r\n\t}\r\n\r\n\t.name {\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\t/* flex: 1; */\r\n\t}\r\n\r\n\t.price {\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\t/* flex: 1; */\r\n\t}\r\n\r\n\t.img {\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\t/* flex: 1; */\r\n\t}\r\n\r\n\t.title {\r\n\t\twidth: 100rpx;\r\n\t\theight: 100rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 100rpx;\r\n\t\t/* font-size: 34rpx; */\r\n\t\tcolor: #666666;\r\n\t}\r\n\r\n\t.item {\r\n\t\twidth: 250rpx;\r\n\t\theight: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin-left: auto;\r\n\t\t/* 将item推到父容器的右边 */\r\n\t\talign-items: center;\r\n\t\t/* justify-content: center; */\r\n\t}\r\n\r\n\t.rigicon {\r\n\t\t/* background-color: bisque; */\r\n\t\twidth: 50rpx;\r\n\t\theight: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 80rpx;\r\n\t}\r\n\r\n\t.picker {\r\n\t\twidth: 250rpx;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\t/* background-color: #007aff; */\r\n\t}\r\n\r\n\t.picker-text {\r\n\t\t/* width: 250rpx; */\r\n\t\theight: 100%;\r\n\t\tcolor: #808080;\r\n\t\tfont-size: 25rpx;\r\n\t}\r\n\r\n\t.picture {\r\n\t\twidth: 250rpx;\r\n\t\ttext-align: center;\r\n\t\tcolor: #808080;\r\n\t\tfont-size: 25rpx;\r\n\t}\r\n\r\n\t.submit {\r\n\t\t/* flex: 1; */\r\n\t\theight: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 80rpx;\r\n\t\tcolor: white;\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: 500;\r\n\t\tmargin: 20rpx 0;\r\n\t\tbackground-color: #007aff;\r\n\t\tborder-radius: 20rpx;\r\n\t}\r\n\r\n\t.input-text {\r\n\t\tcolor: #808080;\r\n\t\tborder: none;\r\n\t\toutline: none;\r\n\t\tbox-shadow: none;\r\n\t\tfont-size: 25rpx;\r\n\t}\r\n\r\n\t.uploaded-image {\r\n\t\theight: 100rpx;\r\n\t\twidth: 100rpx;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/pages/release/release.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api","useUpload","res","UPLOAD_URL"],"mappings":";;;;AA0DC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,OAAM;AAAA,MACN,WAAW;AAAA,MACX,aAAa;AAAA;AAAA,MAEb,eAAe;AAAA;AAAA,MACf,SAAS;AAAA;AAAA,MACT,YAAY,CAAE;AAAA,MACd,aAAa,CAAE;AAAA,MACf,uBAAuB;AAAA,IACxB;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,gBAAe;AAAA,EACpB;AAAA,EACD,SAAS;AAAA;AAAA,IAGR,MAAM,gBAAgB;AACrB,UAAI,aAAa,MAAM,gBAAgB;AACvC,UAAI,cAAc,WAAW,SAAS,GAAG;AACxCA,sBAAAA,MAAI,aAAa;AAAA,aACX;AACN,gBAAQ,KAAI;AAAA,MACb;AAAA,IACA;AAAA;AAAA,IAED,kBAAkB;AACjBC,gBAAAA,IAAI,OAAM,EAAG,KAAK,SAAO;AACxB,YAAI,IAAI,SAAS,KAAK;AAErB,gBAAM,aAAa,IAAI,KAAK,SAAS,IAAI,WAAS;AAAA,YACjD,IAAI,KAAK;AAAA,YACT,SAAS,KAAK;AAAA,UACd,EAAC;AAEF,eAAK,aAAa;AAElB,eAAK,cAAc,CAAC,SAAS,GAAG,WAAW,IAAI,cAAY,SAAS,OAAO,CAAC;AAC5E,cAAI,WAAW,SAAS,GAAG;AAC1B,iBAAK,cAAc,WAAW,CAAC,EAAE;AAAA,UAClC;AAAA,eACM;AACND,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,WAAW;AAAA,YACtB,MAAM;AAAA,UACP,CAAC;AAAA,QACF;AAAA,MACD,CAAC,EAAE,MAAM,SAAO;AACfA,sBAAAA,MAAA,MAAA,SAAA,oCAAc,GAAG;AACjBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAAA,MACF,CAAC;AAAA,IACD;AAAA;AAAA,IAGD,gBAAgB;AACfA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,QACP,UAAU,CAAC,cAAc,UAAU;AAAA,QACnC,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,OAAO,QAAQ;AACvB,gBAAM,gBAAgB,IAAI;AAC1BA,wBAAAA,uDAAY,GAAG;AACf,cAAI,cAAc,SAAS,GAAG;AAC7B,kBAAM;AAAA,cACL;AAAA,cACA;AAAA,YACC,IAAEE,0BAAU;AAAA,cACb,YAAY;AAAA,cACZ,MAAM,IAAI,UAAU,CAAC;AAAA;AAAA,cACrB,eAAe,cAAc,CAAC;AAAA;AAAA,aAC9B;AAED,mBAAQ,EAAC,KAAK,CAACC,SAAQ;AACtB,kBAAI,MAAM,KAAK,MAAMA,IAAG;AACxB,mBAAK,UAAUC,UAAAA,aAAa,IAAI,KAAK;AACrC,mBAAK,kBAAkB;AACvB,mBAAK,gBAAgB;AAAA,aACrB;AAAA,UAgBF;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACD;AAAA,IACD,iBAAiB,GAAG;AACnB,YAAM,gBAAgB,EAAE,OAAO;AAC/B,WAAK,wBAAwB;AAG7B,UAAI,gBAAgB,GAAG;AACtB,aAAK,cAAc,KAAK,WAAW,gBAAgB,CAAC,EAAE;AAAA,aAChD;AACN,aAAK,cAAc;AAAA,MACpB;AAAA,IACA;AAAA,IACD,SAAS;AACRJ,oBAAY,MAAA,MAAA,OAAA,oCAAA,KAAK,WAAU,KAAK,WAAW;AAC3C,UAAI,CAAC,KAAK,aAAa,CAAC,KAAK,eAAe,CAAC,KAAK,SAAS;AAC1DA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AACD;AAAA,MACD;AAEAC,gBAAAA,IAAI,SAAS;AAAA,QACZ,aAAa,KAAK;AAAA,QAClB,WAAW,KAAK;AAAA,QAChB,SAAS,KAAK;AAAA;AAAA;AAAA,OAEd,EAAE,KAAK,SAAO;AACd,YAAI,IAAI,SAAS,KAAK;AACrBD,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,WACV,EAAE,KAAK,MAAM;AACb,uBAAW,MAAM;AAEhBA,4BAAAA,MAAI,UAAU;AAAA,gBACb,OAAO;AAAA,gBACP,YAAY;AAAA,gBACZ,aAAa;AAAA,gBACb,SAAS,CAACG,SAAQ;AACjB,sBAAIA,KAAI,SAAS;AAChBH,kCAAAA,MAAA,MAAA,OAAA,oCAAY,MAAM;AAAA,yBACZ;AACN,yBAAK,cAAc;AAAA,kBACpB;AAAA,gBACA;AAAA,eACD;AAAA,YACD,GAAE,GAAI;AAAA,WACP;AAGD,eAAK,YAAY;AACjB,eAAK,UAAU;AACf,eAAK,gBAAgB;AAAA,eACf;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,OAAO;AAAA,YAClB,MAAM;AAAA,UACP,CAAC;AAAA,QACF;AAAA,MACD,CAAC,EAAE,MAAM,SAAO;AACfA,sBAAAA,MAAA,MAAA,SAAA,oCAAc,GAAG;AACjBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAAA,EAED;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtOD,GAAG,WAAW,eAAe;"}