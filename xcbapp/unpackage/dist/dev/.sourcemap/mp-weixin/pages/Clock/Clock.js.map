{"version":3,"file":"Clock.js","sources":["pages/Clock/Clock.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvQ2xvY2svQ2xvY2sudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"me-container\">\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"state\">\r\n\t\t\t\t{{ isSignedIn ? '已打卡' : '此次未打卡' }}\r\n\t\t\t</view>\r\n\t\t\t<!-- <view class=\"clock\" @click=\"signIn\">\r\n                立即打卡\r\n            </view> -->\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tapi\r\n\t} from '../../api/index.js';\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tisSignedIn: false,\r\n\t\t\t\t// statusMessage: '未打卡', // 默认状态\r\n\t\t\t\ttimestamp: '', // 存储时间戳\r\n\t\t\t\ttime: '',\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\t// options 是一个对象，包含了所有页面路径中的查询参数\r\n\t\t\tif (options.time) {\r\n\t\t\t\tthis.time = options.time; // 将时间戳存储到 data 中\r\n\t\t\t}\r\n\t\t\tthis.signIn();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync signIn(data) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t/*#ifdef H5*/\r\n\t\t\t\t\t  // 在浏览器端（H5）执行的逻辑\r\n\t\t\t\t\t  uni.showModal({\r\n\t\t\t\t\t  \ttitle: '提示',\r\n\t\t\t\t\t  \tcontent: '请前往小程序中进行打卡',\r\n\t\t\t\t\t  \tshowCancel: false,\r\n\t\t\t\t\t  \tsuccess: () => {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t  \t}\r\n\t\t\t\t\t  });\r\n\t\t\t\t\t/*#endif*/\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t/*#ifdef MP-WEIXIN*/\r\n\t\t\t\t\t\tconst token = uni.getStorageSync('token'); // 获取存储的token\r\n\t\t\t\t\t\tif (!token) {\r\n\t\t\t\t\t\t\t// 用户未登录\r\n\t\t\t\t\t\t\t// uni.showModal({\r\n\t\t\t\t\t\t\t// \ttitle: '提示',\r\n\t\t\t\t\t\t\t// \tcontent: '请登录后再打卡',\r\n\t\t\t\t\t\t\t// \tshowCancel: false,\r\n\t\t\t\t\t\t\t// \tsuccess: () => {\r\n\t\t\t\t\t\t\t// \t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t// \t\t\turl: '/pages/login/login', // 跳转到登录页面\r\n\t\t\t\t\t\t\t// \t\t});\r\n\t\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t\t// });\r\n\t\t\t\t\t\t\t// return;\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t// title: '测试测试',\r\n\t\t\t\t\t\t\t\tcontent: '请登录后再打卡',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\t\t\turl: '/pages/login/login', // 跳转到登录页面\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst timestamp = Math.floor(Date.now() / 1000); // 当前时间转换为秒级时间戳\r\n\t\t\t\t\t\tconst currentDate = new Date();\r\n\t\t\t\t\t\tconst currentDay = currentDate.toDateString(); // 获取当前日期\r\n\t\t\t\t\t\tconst signInDate = new Date(this.time * 1000).toDateString(); // 根据传入时间戳获取打卡日期\r\n\t\t\t\t\t\tif (currentDay !== signInDate) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: '不能打卡未来日期！',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 判断传入的时间戳是否在允许打卡的时间范围内\r\n\t\t\t\t\t\tif (this.time < timestamp ) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: '无法对过去的时间打卡！',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst morning = Math.floor(new Date(new Date().getFullYear(), new Date().getMonth(), new Date()\r\n\t\t\t\t\t\t\t.getDate(), 5, 0, 0).getTime() / 1000);\r\n\t\t\t\t\t\tconst noon = Math.floor(new Date(new Date().getFullYear(), new Date().getMonth(), new Date()\r\n\t\t\t\t\t\t\t.getDate(), 12, 0, 0).getTime() / 1000);\r\n\t\t\t\t\t\tconst evening = Math.floor(new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate\r\n\t\t\t\t\t\t\t.getDate(), 20, 30, 0).getTime() / 1000);\r\n\t\t\t\t\t\tconst result = await api.sign(data);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (result.code === 200) {\r\n\t\t\t\t\t\t\tthis.isSignedIn = true;\r\n\t\t\t\t\t\t\tif (timestamp >= morning && timestamp < noon) {\r\n\t\t\t\t\t\t\t\t// this.isSignedIn = true;\r\n\t\t\t\t\t\t\t\tif (timestamp < this.time) {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: result.msg,\r\n\t\t\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (timestamp >= noon && timestamp < evening) {\r\n\t\t\t\t\t\t\t\t// this.isSignedIn = true;\r\n\t\t\t\t\t\t\t\tif (timestamp < this.time) {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: result.msg,\r\n\t\t\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\t\tcontent: result.msg || '打卡超时，请稍后重试',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (result.code === 201) {\r\n\t\t\t\t\t\t\tthis.isSignedIn = false; // 使用后端返回的消息\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: result.msg || '你今日打卡已经超过限定次数',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: result.msg || '操作失败，请稍后重试',\r\n\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/*#endif*/\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('请求打卡接口出错:', error);\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\tcontent: '打卡失败，请稍后重试。',\r\n\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.me-container {\r\n\t\theight: 100vh;\r\n\t\twidth: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tcolor: white;\r\n\t\tz-index: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: flex-start;\r\n\t}\r\n\r\n\t.content {\r\n\t\theight: 100%;\r\n\t\twidth: 90%;\r\n\t\tmargin: auto auto;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.state {\r\n\t\tfont-size: 60rpx;\r\n\t\tmargin-bottom: 100rpx;\r\n\t\tcolor: black;\r\n\t}\r\n\r\n\t.clock {\r\n\t\theight: 5%;\r\n\t\twidth: 50%;\r\n\t\tfont-size: 50rpx;\r\n\t\tborder: 1px solid #007aff;\r\n\t\tbackground-color: #007aff;\r\n\t\tborder-radius: 20rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/pages/Clock/Clock.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","api"],"mappings":"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"}