{"version":3,"file":"dynamics.js","sources":["pages/dynamics/dynamics.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZHluYW1pY3MvZHluYW1pY3MudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <view class=\"dynamic-header\">\n      <text class=\"header-title\">种养朋友圈</text>\n      <view class=\"header-gradient\"></view>\n      <view class=\"update-notice\">按时间追溯农产品生长历程</view>\n    </view>\n\n    <scroll-view class=\"timeline-container\" scroll-y @scrolltolower=\"loadMore\">\n      <!-- 时间轴核心结构 -->\n      <view v-for=\"(group, date) in timelineGroups\" :key=\"date\" class=\"timeline-group\">\n        <view class=\"timeline-date\">\n          <view class=\"timeline-dot\"></view>\n          <text class=\"date-label\">{{date}}</text>\n        </view>\n        \n        <view class=\"timeline-cards\">\n          <view \n            v-for=\"(post, index) in group\" \n            :key=\"index\"\n            class=\"neo-card\">\n            <!-- 原有卡片内容 -->\n            <view class=\"user-header\">\n              <view class=\"post-time\">发布时间:{{initTime(post.created)}}</view>\n              <view class=\"username\">{{post.farmersgoodsname}}</view>\n            </view>\n            \n            <scroll-view \n              class=\"media-scroller\"\n              scroll-x\n              :scroll-with-animation=\"true\"\n              :show-scrollbar=\"false\">\n              <view class=\"media-container\">\n                <view \n                  v-for=\"(item, idx) in post.imgs\"\n                  :key=\"idx\"\n                  class=\"media-item\">\n                  <image \n                    v-if=\"item.fileType === 'image'\"\n                    :src=\"item.path\"\n                    mode=\"aspectFill\"\n                    class=\"media-content\" \n                    @click=\"viewImage(item.path)\"/>\n                  <video\n                    v-else\n                    :src=\"item.path\"\n                    controls\n                    class=\"media-content\"\n                    objectFit=\"cover\"></video>\n                </view>\n              </view>\n            </scroll-view>\n            \n            <view class=\"content-section\">\n              <text class=\"post-content\">{{post.content}}</text>\n              <view class=\"interaction-panel\">\n                <view class=\"action-btn\" @click=\"toggleReaction(post.id)\">\n                  <uni-icons\n                    :type=\"post.liked ? 'heart-filled' : 'heart'\"\n                    :color=\"post.liked ? '#FF6B6B' : '#7A9D7E'\"\n                    size=\"20\" />\n                  <text class=\"count\">{{post.likes}}</text>\n                </view>\n                <view class=\"action-btn\">\n                  <uni-icons \n                    type=\"chat\" \n                    color=\"#7A9D7E\"\n                    size=\"20\" />\n                  <text class=\"count\">{{post.comments}}</text>\n                </view>\n              </view>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <view v-if=\"posts.length<=0\" class=\"empty-tip\">\n        暂无种植记录\n      </view>\n    </scroll-view>\n  </view>\n</template>\r\n<script>\r\n\timport {\r\n\t\tapi\r\n\t} from '@/api/index.js'\r\n\timport {myMixin} from '@/utils/public.js'\r\n\texport default {\r\n\t\tmixins:[myMixin],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tposts: [\r\n\t\t\t\t],\r\n\t\t\t\tqueryData: {\r\n\t\t\t\t\tpage: 1,\r\n\t\t\t\t\tlimit: 10\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t    timelineGroups() {\r\n\t\t      return this.posts.reduce((groups, post) => {\r\n\t\t        const date = this.initDate(post.created)\r\n\t\t        groups[date] = groups[date] || []\r\n\t\t        groups[date].push(post)\r\n\t\t        return groups\r\n\t\t      }, {})\r\n\t\t    }\r\n\t\t  },\r\n\t\tasync onLoad(pramas) {\r\n\t\t\tif(pramas.id){\r\n\t\t\t\tthis.queryData.farmersgoods_id = parseInt(pramas.id)\r\n\t\t\t}\r\n\t\t\tthis.getData()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tviewImage(url){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tshowmenu:false,\r\n\t\t\t\t\turls:[url]\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync getData(){\r\n\t\t\t\tlet data = await api.dynamicsDataList(this.queryData)\r\n\t\t\t\tif (data.code == 200){\r\n\t\t\t\t\t// 处理图片\r\n\t\t\t\t\tlet newList = data.data.listdata.map(item=>{\r\n\t\t\t\t\t\tif (!item['imgs']) return item;\r\n\t\t\t\t\t\titem['imgs'] = item['imgs'].split(',')\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet initData =  item['imgs'].map((anlien)=>{\r\n\t\t\t\t\t\t\tif (anlien.slice(anlien.length-3) == 'mp4'){\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tfileType:'video',\r\n\t\t\t\t\t\t\t\t\tpath:anlien\r\n\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t\tfileType:'image',\r\n\t\t\t\t\t\t\t\t\tpath:anlien\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\titem['imgs'] = initData\r\n\t\t\t\t\t\treturn item\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.posts = [...this.posts,...newList]\r\n\t\t\t\t\tthis.noMore = newList.length < this.queryData.limit;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tloadMore() {\r\n\t\t\t\tif (!this.noMore) {\r\n\t\t\t\t\tthis.queryData.page++;\r\n\t\t\t\t\tthis.getData()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttoggleReaction(index) {\r\n\t\t\t\tconst post = this.posts[index]\r\n\t\t\t\tpost.liked = !post.liked\r\n\t\t\t\tpost.likes += post.liked ? 1 : -1\r\n\t\t\t},\r\n\t\t\tpreviewMedia(url) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: [url]\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tcreatePost() {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/post/create'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<<style lang=\"scss\" scoped>\r\n/* 设计变量 */\r\n$primary-color: #7A9D7E;\r\n$text-primary: #2D4030;\r\n$text-secondary: #8C9B8E;\r\n\r\n\r\n.timeline-container {\n  position: relative;\n  padding: 20px 15px 15px 45px;\n  height: calc(100vh - 120px);\n}\n\n.timeline-group {\n  position: relative;\n  margin-bottom: 25px;\n}\n\n.timeline-date {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15px;\n  position: relative;\n  z-index: 2;\n}\n\n.timeline-dot {\n  width: 16px;\n  height: 16px;\n  background: #7A9D7E;\n  border-radius: 50%;\n  position: absolute;\n  left: -31px;\n  top: 3px;\n  border: 3px solid #f5f7f8;\n  box-shadow: 0 2px 4px rgba(122,157,126,0.2);\n}\n\n.date-label {\n  color: #5B7F61;\n  font-weight: 600;\n  font-size: 16px;\n  background: #f5f7f8;\n  padding: 4px 10px;\n  border-radius: 15px;\n  border: 1px solid #e0e6e1;\n}\n\n/* 时间线装饰 */\n.timeline-container::before {\n  content: '';\n  position: absolute;\n  left: 38px;\n  top: 0;\n  bottom: 0;\n  width: 2px;\n  background: repeating-linear-gradient(\n    180deg,\n    #7A9D7E 0px,\n    #7A9D7E 3px,\n    transparent 3px,\n    transparent 8px\n  );\n}\n\n.timeline-cards {\n  padding-left: 15px;\n}\n\n.timeline-cards .neo-card {\r\n\twidth: 620rpx;\n  margin-bottom: 15px;\n  position: relative;\n}\n\n.timeline-cards .neo-card::before {\n  content: '';\n  position: absolute;\n  left: -26px;\n  top: 24px;\n  width: 12px;\n  height: 12px;\n  background: #d0e0d3;\n  border-radius: 50%;\n}\n\n.empty-tip {\n  text-align: center;\n  padding: 50px 0;\n  color: #7A9D7E;\n  font-size: 16px;\n}\n\n/* 响应式优化 */\n@media (max-width: 480px) {\n  .timeline-container {\n    padding-left: 35px;\n  }\n  \n  .timeline-dot {\n    left: -26px;\n    width: 14px;\n    height: 14px;\n  }\n  \n  .timeline-container::before {\n    left: 28px;\n  }\n}\r\n.container {\r\n  background: #f8faf7;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* 渐变标题栏 */\r\n.dynamic-header {\r\n  padding: 48rpx 32rpx 64rpx;\r\n  position: relative;\r\n  \r\n  .header-title {\r\n    position: relative;\r\n    z-index: 2;\r\n    font-size: 44rpx;\r\n    font-weight: 600;\r\n    color: $text-primary;\r\n    letter-spacing: 2rpx;\r\n  }\r\n  \r\n  .header-gradient {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 160rpx;\r\n    background: linear-gradient(135deg, rgba($primary-color, 0.1) 0%, rgba($primary-color, 0.05) 100%);\r\n    transform: skewY(-2deg);\r\n  }\r\n}\r\n\r\n/* 动态卡片 */\r\n.neo-card {\r\n  background: #fff;\r\n  border-radius: 24rpx;\r\n  margin: 24rpx;\r\n  box-shadow: 0 8rpx 24rpx rgba(122,157,126,0.08);\r\n  overflow: hidden;\r\n  \r\n  .user-header {\r\n    padding: 32rpx;\r\n    \r\n    .user-meta {\r\n      .username {\r\n\t\tmargin-top: 20rpx;\r\n        font-size: 30rpx;\r\n        color: gray;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .post-time {\r\n        font-size: 30rpx;\r\n        color: black;\r\n\t\tfont-weight: bold;\r\n        margin-top: 8rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .media-scroller {\r\n    padding: 0 0 32rpx;\r\n    \r\n    .media-container {\r\n      display: flex;\r\n      padding: 0 32rpx;\r\n      width: max-content;\r\n      \r\n      .media-item {\r\n        width: 560rpx;\r\n        height: 420rpx;\r\n        border-radius: 16rpx;\r\n        overflow: hidden;\r\n        margin-right: 24rpx;\r\n        box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.08);\r\n        \r\n        .media-content {\r\n          width: 100%;\r\n          height: 100%;\r\n        }\r\n        \r\n        video {\r\n          width: 100%;\r\n          height: 100%;\r\n          object-fit: cover;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .content-section {\r\n    padding: 0 32rpx 32rpx;\r\n    \r\n    .post-content {\r\n      font-size: 28rpx;\r\n      color: $text-primary;\r\n      line-height: 1.6;\r\n      margin-bottom: 24rpx;\r\n    }\r\n    \r\n    .interaction-panel {\r\n      display: flex;\r\n      gap: 48rpx;\r\n      border-top: 1rpx solid rgba($primary-color, 0.1);\r\n      padding-top: 24rpx;\r\n      \r\n      .action-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        transition: transform 0.2s ease;\r\n        \r\n        &:active {\r\n          transform: scale(0.95);\r\n        }\r\n        \r\n        .count {\r\n          color: $primary-color;\r\n          font-size: 28rpx;\r\n          margin-left: 12rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>","import MiniProgramPage from 'E:/小程序转app/xcbapp/pages/dynamics/dynamics.vue'\nwx.createPage(MiniProgramPage)"],"names":["myMixin","uni","api"],"mappings":";;;;AAuFC,MAAK,YAAU;AAAA,EACd,QAAO,CAACA,aAAAA,OAAO;AAAA,EACf,OAAO;AACN,WAAO;AAAA,MACN,OAAO,CACN;AAAA,MACD,WAAW;AAAA,QACV,MAAM;AAAA,QACN,OAAO;AAAA,MACR;AAAA,IACD;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACN,iBAAiB;AACf,aAAO,KAAK,MAAM,OAAO,CAAC,QAAQ,SAAS;AACzC,cAAM,OAAO,KAAK,SAAS,KAAK,OAAO;AACvC,eAAO,IAAI,IAAI,OAAO,IAAI,KAAK,CAAC;AAChC,eAAO,IAAI,EAAE,KAAK,IAAI;AACtB,eAAO;AAAA,MACR,GAAE,EAAE;AAAA,IACP;AAAA,EACD;AAAA,EACH,MAAM,OAAO,QAAQ;AACpB,QAAG,OAAO,IAAG;AACZ,WAAK,UAAU,kBAAkB,SAAS,OAAO,EAAE;AAAA,IACpD;AACA,SAAK,QAAQ;AAAA,EACb;AAAA,EACD,SAAS;AAAA,IACR,UAAU,KAAI;AACbC,oBAAAA,MAAI,aAAa;AAAA,QAChB,UAAS;AAAA,QACT,MAAK,CAAC,GAAG;AAAA,OACT;AAAA,IACD;AAAA,IACD,MAAM,UAAS;AACd,UAAI,OAAO,MAAMC,UAAAA,IAAI,iBAAiB,KAAK,SAAS;AACpD,UAAI,KAAK,QAAQ,KAAI;AAEpB,YAAI,UAAU,KAAK,KAAK,SAAS,IAAI,UAAM;AAC1C,cAAI,CAAC,KAAK,MAAM;AAAG,mBAAO;AAC1B,eAAK,MAAM,IAAI,KAAK,MAAM,EAAE,MAAM,GAAG;AAErC,cAAI,WAAY,KAAK,MAAM,EAAE,IAAI,CAAC,WAAS;AAC1C,gBAAI,OAAO,MAAM,OAAO,SAAO,CAAC,KAAK,OAAM;AAC1C,qBAAO;AAAA,gBACN,UAAS;AAAA,gBACT,MAAK;AAAA,cACN;AAAA,mBACI;AACJ,qBAAO;AAAA,gBACN,UAAS;AAAA,gBACT,MAAK;AAAA,cACN;AAAA,YACD;AAAA,WACA;AACD,eAAK,MAAM,IAAI;AACf,iBAAO;AAAA,SACP;AACD,aAAK,QAAQ,CAAC,GAAG,KAAK,OAAM,GAAG,OAAO;AACtC,aAAK,SAAS,QAAQ,SAAS,KAAK,UAAU;AAAA,MAC/C;AAAA,IACA;AAAA,IACD,WAAW;AACV,UAAI,CAAC,KAAK,QAAQ;AACjB,aAAK,UAAU;AACf,aAAK,QAAQ;AAAA,MACd;AAAA,IACA;AAAA,IACD,eAAe,OAAO;AACrB,YAAM,OAAO,KAAK,MAAM,KAAK;AAC7B,WAAK,QAAQ,CAAC,KAAK;AACnB,WAAK,SAAS,KAAK,QAAQ,IAAI;AAAA,IAC/B;AAAA,IACD,aAAa,KAAK;AACjBD,oBAAAA,MAAI,aAAa;AAAA,QAChB,MAAM,CAAC,GAAG;AAAA,OACV;AAAA,IACD;AAAA,IACD,aAAa;AACZA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,OACL;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3KD,GAAG,WAAW,eAAe;"}