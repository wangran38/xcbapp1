<view class="traceability-page"><view class="header-container"><view class="progress-bar"><view class="progress-value" style="{{'width:'+(formCompletionRate+'%')+';'}}"></view></view><view class="header-content"><text class="header-title">菜品溯源信息</text><text class="header-subtitle">填写越完整，消费者越放心</text></view></view><view class="consumer-tip"><text class="tip-text">消费者最关心：产地环境、种植/养殖方式、农药/饲料使用、检测报告</text></view><view class="form-container"><view class="form-section"><view class="section-header"><text class="section-title">基本信息</text><text class="section-desc">消费者必看</text></view><view class="form-item"><view class="item-label">产品名称<text class="required-mark">*</text></view><view class="item-content"></view></view><view class="form-item"><view class="item-label">产品分类<text class="required-mark">*</text></view><view class="item-content"><picker range="{{CLASSIFICATION}}" value="{{classificationIndex}}" data-event-opts="{{[['change',[['changeClassification',['$event']]]]]}}" bindchange="__e"><view class="picker-text">{{''+(CLASSIFICATION[classificationIndex]||'请选择分类')+''}}</view></picker></view></view><view class="form-item"><view class="item-label">产地<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openLocationPicker',['$event']]]]]}}" class="location-picker" bindtap="__e"><text class="location-text">{{TraceabilityInfo.Students||'点击选择产地'}}</text><block tt:if="{{TraceabilityInfo.Students}}"><icon type="location" size="16" color="#36a3ff"></icon></block></view></view></view><view class="form-item"><view class="item-label">生产日期<text class="required-mark">*</text></view><view class="item-content"><uni-datetime-picker bind:input="__e" class="date-picker" vue-id="39c4494a-1" type="date" clear-icon="{{false}}" return-type="timestamp" placeholder="选择生产日期" value="{{TraceabilityInfo.productionDate}}" data-event-opts="{{[['^input',[['__set_model',['$0','productionDate','$event',[]],['TraceabilityInfo']]]]]}}" bind:__l="__l"></uni-datetime-picker></view></view><view class="form-item"><view class="item-label">批次号</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['batchNumber']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.batchNumber||'点击输入批次号'}}</text></view></view></view></view><block tt:if="{{classificationIndex===0}}"><view class="form-section"><view class="section-header"><text class="section-title">种植信息</text><text class="section-desc">消费者最关心农药使用</text></view><view class="form-item"><view class="item-label">农药名称<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['pesticideName']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.pesticideName||'点击输入农药名称'}}</text></view></view></view><view class="form-item"><view class="item-label">农药使用次数</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['pesticideTimes']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.pesticideTimes||'点击输入使用次数'}}</text></view></view></view><view class="form-item"><view class="item-label">最后施药日期</view><view class="item-content"><uni-datetime-picker bind:input="__e" class="date-picker" vue-id="39c4494a-2" type="date" clear-icon="{{false}}" return-type="timestamp" placeholder="选择日期" value="{{TraceabilityInfo.lastPesticideDate}}" data-event-opts="{{[['^input',[['__set_model',['$0','lastPesticideDate','$event',[]],['TraceabilityInfo']]]]]}}" bind:__l="__l"></uni-datetime-picker></view></view><view class="form-item"><view class="item-label">农残检测报告<text class="required-mark">*</text></view><view class="item-content"><view class="upload-container"><block tt:for="{{pesticideCertImages}}" tt:for-item="item" tt:for-index="index" tt:key="index"><view class="upload-box"><image class="upload-image" src="{{item}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['deleteCertificate',[index,'pesticide']]]]]}}" class="delete-btn" bindtap="__e"><icon type="cancel" size="16" color="#fff"></icon></view></view></block><view data-event-opts="{{[['tap',[['choosePesticideCertificate',['$event']]]]]}}" class="upload-box add-box" bindtap="__e"><icon type="camera" size="24" color="#999"></icon><text class="upload-text">上传报告</text></view></view></view></view><view class="form-item"><view class="item-label">灌溉水源</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['irrigationWater']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.irrigationWater||'点击输入灌溉水源'}}</text></view></view></view><view class="form-item"><view class="item-label">种植周期(天)</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['plantingCycle']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.plantingCycle||'点击输入种植周期'}}</text></view></view></view><view class="form-item"><view class="item-label">土壤类型</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['soilType']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.soilType||'点击输入土壤类型'}}</text></view></view></view></view></block><block tt:if="{{classificationIndex===1}}"><view class="form-section"><view class="section-header"><text class="section-title">养殖信息</text><text class="section-desc">消费者最关心饲料与养殖环境</text></view><view class="form-item"><view class="item-label">饲料名称<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['feedName']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.feedName||'点击输入饲料名称'}}</text></view></view></view><view class="form-item"><view class="item-label">饲料来源<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['feedSource']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.feedSource||'点击输入饲料来源'}}</text></view></view></view><view class="form-item"><view class="item-label">饲料检测报告<text class="required-mark">*</text></view><view class="item-content"><view class="upload-container"><block tt:for="{{feedCertImages}}" tt:for-item="item" tt:for-index="index" tt:key="index"><view class="upload-box"><image class="upload-image" src="{{item}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['deleteCertificate',[index,'feed']]]]]}}" class="delete-btn" bindtap="__e"><icon type="cancel" size="16" color="#fff"></icon></view></view></block><view data-event-opts="{{[['tap',[['chooseFeedCertificate',['$event']]]]]}}" class="upload-box add-box" bindtap="__e"><icon type="camera" size="24" color="#999"></icon><text class="upload-text">上传报告</text></view></view></view></view><view class="form-item"><view class="item-label">养殖周期(天)</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['breedingCycle']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.breedingCycle||'点击输入养殖周期'}}</text></view></view></view><view class="form-item"><view class="item-label">防疫记录</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['epidemicPrevention']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.epidemicPrevention||'点击输入防疫情况'}}</text></view></view></view><view class="form-item"><view class="item-label">养殖环境描述</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['breedingEnvironment']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.breedingEnvironment||'点击输入环境描述'}}</text></view></view></view><view class="form-item"><view class="item-label">养殖方式</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['breedingMethod']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.breedingMethod||'点击输入养殖方式'}}</text></view></view></view></view></block><block tt:if="{{classificationIndex===2}}"><view class="form-section"><view class="section-header"><text class="section-title">加工信息</text><text class="section-desc">消费者最关心添加剂与卫生情况</text></view><view class="form-item"><view class="item-label">加工原料<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['processingMaterials']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.processingMaterials||'点击输入加工原料'}}</text></view></view></view><view class="form-item"><view class="item-label">食品添加剂</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['foodAdditives']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.foodAdditives||'点击输入添加剂信息'}}</text></view></view></view><view class="form-item"><view class="item-label">加工工艺</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['processingTechnology']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.processingTechnology||'点击输入加工工艺'}}</text></view></view></view><view class="form-item"><view class="item-label">加工环境检测</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['processingEnvironment']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.processingEnvironment||'点击输入检测结果'}}</text></view></view></view><view class="form-item"><view class="item-label">加工设备编号</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['processingEquipment']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.processingEquipment||'点击输入设备编号'}}</text></view></view></view><view class="form-item"><view class="item-label">加工卫生许可证</view><view class="item-content"><view class="upload-container"><block tt:for="{{processingCertImages}}" tt:for-item="item" tt:for-index="index" tt:key="index"><view class="upload-box"><image class="upload-image" src="{{item}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['deleteCertificate',[index,'processing']]]]]}}" class="delete-btn" bindtap="__e"><icon type="cancel" size="16" color="#fff"></icon></view></view></block><view data-event-opts="{{[['tap',[['chooseProcessingCertificate',['$event']]]]]}}" class="upload-box add-box" bindtap="__e"><icon type="camera" size="24" color="#999"></icon><text class="upload-text">上传证书</text></view></view></view></view></view></block><block tt:if="{{classificationIndex===3}}"><view class="form-section"><view class="section-header"><text class="section-title">产品信息</text><text class="section-desc">消费者最关心材质与安全性</text></view><view class="form-item"><view class="item-label">产品材质<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['productMaterial']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.productMaterial||'点击输入产品材质'}}</text></view></view></view><view class="form-item"><view class="item-label">生产厂家<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['manufacturer']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.manufacturer||'点击输入生产厂家'}}</text></view></view></view><view class="form-item"><view class="item-label">生产地址<text class="required-mark">*</text></view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['manufacturerAddress']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.manufacturerAddress||'点击输入生产地址'}}</text></view></view></view><view class="form-item"><view class="item-label">联系方式</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['manufacturerPhone']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.manufacturerPhone||'点击输入联系电话'}}</text></view></view></view><view class="form-item"><view class="item-label">产品认证</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['productCertification']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.productCertification||'点击输入认证信息'}}</text></view></view></view><view class="form-item"><view class="item-label">安全检测报告</view><view class="item-content"><view class="upload-container"><block tt:for="{{otherCertImages}}" tt:for-item="item" tt:for-index="index" tt:key="index"><view class="upload-box"><image class="upload-image" src="{{item}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['deleteCertificate',[index,'other']]]]]}}" class="delete-btn" bindtap="__e"><icon type="cancel" size="16" color="#fff"></icon></view></view></block><view data-event-opts="{{[['tap',[['chooseOtherCertificate',['$event']]]]]}}" class="upload-box add-box" bindtap="__e"><icon type="camera" size="24" color="#999"></icon><text class="upload-text">上传报告</text></view></view></view></view></view></block><view class="form-section"><view class="section-header"><text class="section-title">通用信息</text><text class="section-desc">消费者关注的附加信息</text></view><view class="form-item"><view class="item-label">运输方式</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['transportMethod']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.transportMethod||'点击输入运输方式'}}</text></view></view></view><view class="form-item"><view class="item-label">储存条件</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['storageConditions']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.storageConditions||'点击输入储存条件'}}</text></view></view></view><view class="form-item"><view class="item-label">保质期(天)</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['shelfLife']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.shelfLife||'点击输入保质期'}}</text></view></view></view><view class="form-item"><view class="item-label">营养价值</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['nutritionValue']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.nutritionValue||'点击输入营养价值'}}</text></view></view></view><view class="form-item"><view class="item-label">食用方法</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['cookingMethod']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.cookingMethod||'点击输入食用方法'}}</text></view></view></view><view class="form-item"><view class="item-label">溯源凭证</view><view class="item-content"><view class="upload-container"><block tt:for="{{certificateImages}}" tt:for-item="item" tt:for-index="index" tt:key="index"><view class="upload-box"><image class="upload-image" src="{{item}}" mode="aspectFill"></image><view data-event-opts="{{[['tap',[['deleteCertificate',[index,'general']]]]]}}" class="delete-btn" bindtap="__e"><icon type="cancel" size="16" color="#fff"></icon></view></view></block><view data-event-opts="{{[['tap',[['chooseCertificateImage',['$event']]]]]}}" class="upload-box add-box" bindtap="__e"><icon type="camera" size="24" color="#999"></icon><text class="upload-text">上传凭证</text></view></view></view></view><view class="form-item"><view class="item-label">备注信息</view><view class="item-content"><view data-event-opts="{{[['tap',[['openPopup',['notes']]]]]}}" class="input-field" bindtap="__e"><text class="input-text">{{TraceabilityInfo.notes||'点击输入备注信息'}}</text></view></view></view></view></view><view class="submit-container"><button class="submit-button" disabled="{{isSubmitting}}" data-event-opts="{{[['tap',[['submit',['$event']]]]]}}" bindtap="__e">{{''+(isSubmitting?'提交中...':'提交溯源信息')+''}}</button></view><view class="footer-tip"><text>注：<text class="required-mark">*</text>为必填项，完整填写可提升消费者信任度</text></view><uni-popup class="vue-ref" vue-id="39c4494a-3" type="bottom" border-radius="12rpx 12rpx 0 0" data-ref="popup" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content"><input class="popup-input" placeholder="请输入" data-event-opts="{{[['confirm',[['handleInputConfirm',['$event']]]],['blur',[['handleInputBlur',['$event']]]],['input',[['__set_model',['','currentInputValue','$event',[]]]]]]}}" value="{{currentInputValue}}" bindconfirm="__e" bindblur="__e" bindinput="__e"/></view></uni-popup></view>