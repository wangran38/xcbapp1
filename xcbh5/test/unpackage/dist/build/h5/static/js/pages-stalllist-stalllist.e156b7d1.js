(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-stalllist-stalllist"],{"0e82":function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("c7eb")),o=i(a("1da1")),s=i(a("5530")),r=i(a("3835"));a("c1f9"),a("4de4"),a("d3b7"),a("4fad"),a("d9e2"),a("d401"),a("99af");var c={data:function(){return{page:1,limit:10,totalnum:0,pageData:[],pageLoading:!1,hasMore:!0,searchParams:{}}},computed:{queryParams:function(){var t=Object.fromEntries(Object.entries(this.searchParams).filter((function(t){var e=(0,r.default)(t,2),a=(e[0],e[1]);return""!==a})));return(0,s.default)({page:this.page,limit:this.limit,isshow:1},t)}},methods:{loadPageData:function(){var t=this;return(0,o.default)((0,n.default)().mark((function e(){var a;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.hasMore&&!t.pageLoading){e.next=2;break}return e.abrupt("return");case 2:return t.pageLoading=!0,e.prev=3,e.next=6,t.fetchData(t.queryParams);case 6:a=e.sent,t.querySuccess(a),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](3),t.handleFetchError(e.t0);case 13:return e.prev=13,t.pageLoading=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})))()},fetchData:function(t){return(0,o.default)((0,n.default)().mark((function t(){return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:throw new Error("fetchData 方法未实现");case 1:case"end":return t.stop()}}),t)})))()},querySuccess:function(t){null!==t&&void 0!==t&&t.listdata&&(this.pageData=1===this.page?t.listdata:this.pageData.concat(t.listdata),this.totalnum=t.totalnum||0,this.hasMore=this.pageData.length<this.totalnum)},handleScrollToLower:function(){!this.pageLoading&&this.hasMore&&(this.page+=1,this.loadPageData())},handleFetchError:function(t){console.error("Error loading data:",t)},resetPagination:function(){this.page=1,this.pageData=[],this.totalnum=0,this.hasMore=!0},reloadData:function(){this.resetPagination(),this.loadPageData()}}};e.default=c},"28e0":function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"me-container"},[a("v-uni-scroll-view",{staticClass:"Stallholder",style:{height:"100vh"},attrs:{"scroll-y":"true"},on:{scrolltolower:function(e){arguments[0]=e=t.$handleEvent(e),t.handleScrollToLower.apply(void 0,arguments)}}},[t._l(t.pageData,(function(e){return a("v-uni-view",{key:e.id,staticClass:"item-list"},[a("v-uni-view",{staticClass:"logo",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotostaldis(e.id)}}},[t.isloaded?a("v-uni-image",{staticClass:"logos",attrs:{"lazy-load":!0,src:e.logo,mode:"aspectFill"}}):t._e()],1),a("v-uni-view",{staticClass:"info",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.gotostaldis(e.id)}}},[a("v-uni-view",{staticClass:"message"},[t._v("菜市场名称："+t._s(e.market_name))]),a("v-uni-view",{staticClass:"message"},[t._v("摊位名称："+t._s(e.title))]),a("v-uni-view",{staticClass:"message"},[t._v("摊位编号："+t._s(e.id))])],1),a("v-uni-view",{staticClass:"interface"},[a("v-uni-view",{staticClass:"edit",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.editShop(e)}}},[t._v("编辑")]),a("v-uni-view",{staticClass:"delete",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.deleteShop(e)}}},[t._v("删除")])],1)],1)})),t.pageLoading?a("v-uni-view",{staticClass:"loading"},[t._v("加载中...")]):t._e(),t.hasMore?t._e():a("v-uni-view",{staticClass:"loading"},[t._v("没有更多了")])],2),t.showEditPopup?a("v-uni-view",{staticClass:"popup-overlay",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closePopup.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"popup",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e)}}},[a("v-uni-view",{staticClass:"close-button",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closePopup.apply(void 0,arguments)}}},[t._v("×")]),a("v-uni-view",{staticClass:"popup-content"},[a("v-uni-view",{staticClass:"content"},[a("v-uni-view",{staticClass:"cuisine"},[a("v-uni-view",{staticClass:"title"},[t._v("摊位名称")]),a("v-uni-view",{staticClass:"shuru"},[a("v-uni-input",{staticClass:"shurucon",attrs:{type:"text"},model:{value:t.currentShopTitle,callback:function(e){t.currentShopTitle=e},expression:"currentShopTitle"}})],1)],1),a("v-uni-view",{staticClass:"editimg"},[a("v-uni-view",{staticClass:"title"},[t._v("摊位图片")]),a("v-uni-image",{staticClass:"cimg",attrs:{src:t.currentShopLogo,mode:"aspectFit"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.uploadcuisine.apply(void 0,arguments)}}})],1)],1)],1),a("v-uni-view",{staticClass:"popup-footer"},[a("v-uni-button",{on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closePopup.apply(void 0,arguments)}}},[t._v("取消")]),a("v-uni-button",{staticStyle:{"background-color":"#007aff",color:"white"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.confirmEdit.apply(void 0,arguments)}}},[t._v("确认")])],1)],1)],1):t._e()],1)},n=[]},"4fad":function(t,e,a){var i=a("23e7"),n=a("6f53").entries;i({target:"Object",stat:!0},{entries:function(t){return n(t)}})},"532b":function(t,e,a){"use strict";var i=a("f2ec"),n=a.n(i);n.a},"5e7f":function(t,e,a){"use strict";a.r(e);var i=a("28e0"),n=a("d39d");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("532b");var s=a("f0c5"),r=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"94874b7a",null,!1,i["a"],void 0);e["default"]=r.exports},7131:function(t,e,a){"use strict";a("7a82");var i=a("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("5530")),o=i(a("c7eb")),s=i(a("1da1")),r=a("6c0c"),c=i(a("0e82")),l=a("a15b"),u={data:function(){return{pageData:[],shopList:[],imageUploaded:!1,showEditPopup:!1,currentShopTitle:"",currentShopLogo:"",isloaded:!1}},mixins:[c.default],onLoad:function(){this.isloaded=!0},created:function(){this.reloadData()},methods:{deleteShop:function(t){var e=this;return(0,s.default)((0,o.default)().mark((function a(){var i;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.api.editshop({id:t.id,isshow:2});case 2:i=a.sent,200==i.code&&(uni.showToast({title:"删除成功",icon:"success"}),e.reloadData());case 4:case"end":return a.stop()}}),a)})))()},fetchData:function(t){return(0,s.default)((0,o.default)().mark((function e(){var a;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.api.getMyShops((0,n.default)({},t));case 3:return a=e.sent,e.abrupt("return",a.data);case 7:e.prev=7,e.t0=e["catch"](0),console.error("获取摊位列表失败",e.t0),uni.showToast({title:"获取摊位列表失败",icon:"none"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()},editShop:function(t){this.currentShopId=t.id,this.currentShopTitle=t.title,this.currentShopLogo=t.logo,this.showEditPopup=!0},closePopup:function(){this.showEditPopup=!1},confirmEdit:function(t){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.currentShopTitle){t.next=3;break}return uni.showToast({title:"请输入摊位名称",icon:"none"}),t.abrupt("return");case 3:if(e.imageUploaded||e.currentShopLogo){t.next=6;break}return uni.showToast({title:"请上传图片",icon:"none"}),t.abrupt("return");case 6:return t.prev=6,console.log("Calling editshop API"),t.next=10,r.api.editshop({id:e.currentShopId,title:e.currentShopTitle,logo:e.currentShopLogo});case 10:a=t.sent,200===a.code?(uni.showToast({title:"摊位信息修改成功",icon:"success"}),e.reloadData(),e.closePopup()):uni.showToast({title:a.msg||"摊位信息修改失败",icon:"none"}),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](6),uni.showToast({title:"修改失败，请稍后重试",icon:"none"});case 17:case"end":return t.stop()}}),t,null,[[6,14]])})))()},uploadcuisine:function(){var t=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var a=e.tempFilePaths;if(a.length>0){var i=(0,l.useUpload)({uploadPath:"/group1/upload",tempFilePaths:a[0]}),n=i.upload;i.request;n().then((function(e){console.log(e),t.currentShopLogo=e,console.log("更新后的图片路径:",t.currentShopLogo),t.isImageSelected=!0,t.imageUploaded=!0}))}}})},gotostaldis:function(t){uni.navigateTo({url:"/pages/Stalls-dishes/Stalls-dishes?id=".concat(t)})}}};e.default=u},c1f9:function(t,e,a){var i=a("23e7"),n=a("2266"),o=a("8418");i({target:"Object",stat:!0},{fromEntries:function(t){var e={};return n(t,(function(t,a){o(e,t,a)}),{AS_ENTRIES:!0}),e}})},cc73:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,".me-container[data-v-94874b7a]{overflow:hidden;width:100%;box-sizing:border-box;padding:%?0?% %?30?% 0 %?30?%;color:#fff;z-index:1;background-color:#f4f4f4;display:flex;flex-direction:column;justify-content:center}.item-list[data-v-94874b7a]{height:%?200?%;width:100%;margin-top:%?15?%;display:flex;flex-direction:row;justify-content:flex-start;align-items:center;background-color:#fff;border-radius:%?20?%}.logo[data-v-94874b7a]{height:%?180?%;width:30%;text-align:center;line-height:%?200?%;background-color:#1296db;border-radius:%?20?%\n\t/* padding: 10rpx 10rpx; */}.logos[data-v-94874b7a]{height:%?180?%;width:100%;border-radius:%?20?%}.info[data-v-94874b7a]{height:%?200?%;width:50%;margin-left:%?10?%;\n\t/* 设置info和logo之间的间距 */display:flex;flex-direction:column;\n\t/* justify-content: space-between; */flex:1;\n\t/* 确保info占据剩余空间 */overflow:hidden\n\t/* 确保内容不溢出 */}.message[data-v-94874b7a]{width:100%;margin:%?10?%;\n\t/* 调整这个值以改变上下间距 */color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.interface[data-v-94874b7a]{height:100%;width:20%;display:flex;flex-direction:column;justify-content:center;align-items:center;margin-left:auto;\n\t/* 设置interface与info的间距 */position:relative\n\t/* margin-right: 0rpx; */\n\t/* background-color: #1296db; */}.interface>.edit[data-v-94874b7a]{text-align:center;color:#fff;font-size:%?30?%;width:%?100?%;height:%?50?%;line-height:%?50?%;background-color:#1296db;border-radius:%?20?%;margin-bottom:%?20?%}.interface>.delete[data-v-94874b7a]{text-align:center;color:#fff;font-size:%?30?%;width:%?100?%;height:%?50?%;line-height:%?50?%;background-color:#ff1909;border-radius:%?20?%}.loading[data-v-94874b7a]{text-align:center;padding:%?20?%;color:#999}.popup-overlay[data-v-94874b7a]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000;color:#000}.popup[data-v-94874b7a]{position:relative;width:80%;max-width:%?600?%;background-color:#fff;border-radius:%?20?%;padding:%?20?%;box-shadow:0 0 15px rgba(0,0,0,.2)}.popup-header[data-v-94874b7a]{font-size:%?36?%;font-weight:700;margin-bottom:%?20?%;text-align:center}.popup-content[data-v-94874b7a]{\n\t/* 这里你可以添加弹出层内容的样式 */display:flex;width:100%;padding:%?30?%;box-sizing:border-box;justify-content:center;align-items:center}.popup-footer[data-v-94874b7a]{display:flex;justify-content:space-between;margin-top:%?10?%}.close-button[data-v-94874b7a]{position:absolute;top:%?5?%;right:%?5?%;font-size:%?40?%;color:#000;cursor:pointer;z-index:10;width:%?80?%;height:%?80?%;display:flex;justify-content:center;align-items:center;background-color:#fff;border-radius:50%;box-shadow:0 0 %?10?% rgba(0,0,0,.1)}.cimg[data-v-94874b7a]{width:%?100?%;height:%?100?%}.content[data-v-94874b7a]{width:100%;height:%?200?%}.cuisine[data-v-94874b7a]{width:100%;height:%?100?%;display:flex;justify-content:space-between;align-items:center}.editimg[data-v-94874b7a]{width:100%;height:%?100?%;display:flex;justify-content:space-between;align-items:center}.title[data-v-94874b7a]{font-size:%?35?%}.shuru[data-v-94874b7a]{width:auto;height:%?100?%;display:flex;justify-content:end;align-items:center}.shurucon[data-v-94874b7a]{text-align:end;font-size:%?35?%}",""]),t.exports=e},d39d:function(t,e,a){"use strict";a.r(e);var i=a("7131"),n=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);e["default"]=n.a},f2ec:function(t,e,a){var i=a("cc73");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var n=a("4f06").default;n("656944f0",i,!0,{sourceMap:!1,shadowMode:!1})}}]);