(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/user"],{"078d":function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("89ee");o(n("3240"));var r=o(n("4a86"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},4924:function(e,t,n){"use strict";(function(e,o){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),c=r(n("ee10")),i=n("4860"),s=n("64af"),u={data:function(){return{isLoggedIn:!1,userName:"",userAvatar:"",score:"",totalnum:0,signTotal:{}}},onShow:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.api.signTotal({});case 2:n=t.sent,e.signTotal=n.data,e.checkLoginStatus(),e.isLoggedIn&&e.fetchUserProfile(),e.signlist();case 7:case"end":return t.stop()}}),t)})))()},methods:{checkUpdate:function(){if(3==(0,s.getPlatform)())if(e.canIUse("getUpdateManager")){var t=o.getUpdateManager();t.onCheckForUpdate((function(e){e.hasUpdate?t.onUpdateReady((function(){o.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(e){e.confirm&&t.applyUpdate()}})})):o.showToast({title:"已经是最新版了",icon:"success"})}))}else o.showModal({title:"提示",content:"当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。"});else o.showToast({title:"当前客户端不支持检查更新",icon:"error"})},checkLoginStatus:function(){var e=o.getStorageSync("token");this.isLoggedIn=!!e},fetchUserProfile:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n,r,c,s,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,o.getStorageSync("token"),t.next=4,i.api.getUserProfile();case 4:n=t.sent,200===n.code?(r=n.data,c=r.name,s=r.Headimgurl,u=r.score,e.userName=c,e.userAvatar=s,e.score=u):o.showToast({title:"获取用户信息失败",icon:"none"}),t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error fetching user profile:",t.t0),o.showToast({title:"获取用户信息失败",icon:"none"});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},signlist:function(e){var t=this;return(0,c.default)(a.default.mark((function e(){var n,r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=o.getStorageSync("token"),e.next=3,i.api.signlist(n);case 3:r=e.sent,t.totalnum=r.data.totalnum;case 5:case"end":return e.stop()}}),e)})))()},login:function(){o.navigateTo({url:"/pages/login/login"})},Apply:function(){o.navigateTo({url:"/pages/Apply/Apply"})},useredit:function(){o.navigateTo({url:"/pages/user-edit/user-edit"})},coupons:function(){o.navigateTo({url:"/pages/coupons/coupons"})},lottery:function(){o.navigateTo({url:"/pages/clock-records/clock-records"})},toorders:function(e){o.navigateTo({url:"/pages/orders/orders?orderStatus=".concat(e)})},mypoints:function(){o.navigateTo({url:"/pages/MyPoints-records/MyPoints-records"})},logout:function(){try{o.removeStorageSync("token"),o.removeStorageSync("nickname"),console.log("Token and nickname removed from storage")}catch(e){console.error("Failed to remove token or nickname from storage",e)}this.isLoggedIn=!1,this.nickname="",this.userName="",o.redirectTo({url:"/pages/login/login"})},bindingWechat:function(){return(0,c.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.getSystemInfo();case 2:t=e.sent,t[1].host&&"WeChat"==t[1].host.env?o.login({provider:"true",success:function(){var e=(0,c.default)(a.default.mark((function e(t){var n;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(t.code,"这是用户唯一标识"),发送code,e.next=4,i.api.bindingOpenid({code:t.code});case 4:n=e.sent,console.log(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fail:function(){},complete:function(){}}):o.showToast({title:"浏览器不支持调用api,请前往小程序端进行账号绑定",duration:3e3,icon:"error"});case 4:case"end":return e.stop()}}),e)})))()}}};t.default=u}).call(this,n("3223")["default"],n("df3c")["default"])},"4a86":function(e,t,n){"use strict";n.r(t);var o=n("8ba1"),r=n("ed17");for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("638f");var c=n("828b"),i=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=i.exports},"638f":function(e,t,n){"use strict";var o=n("c653"),r=n.n(o);r.a},"8ba1":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"a7f4"))}},r=function(){var e=this.$createElement;this._self._c},a=[]},c653:function(e,t,n){},ed17:function(e,t,n){"use strict";n.r(t);var o=n("4924"),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=r.a}},[["078d","common/runtime","common/vendor"]]]);