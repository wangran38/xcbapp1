(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0276":function(e,t,a){"use strict";(function(e,t){var n=a("47a9");a("89ee");n(a("3240"));var r=n(a("1c88"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(r.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},1792:function(e,t,a){"use strict";var n=a("f70a"),r=a.n(n);r.a},"1c88":function(e,t,a){"use strict";a.r(t);var n=a("b49f"),r=a("371d");for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);a("1792"),a("2bf4");var o=a("828b"),c=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports},"2bf4":function(e,t,a){"use strict";var n=a("ca9c"),r=a.n(n);r.a},"371d":function(e,t,a){"use strict";a.r(t);var n=a("dd57"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=r.a},b49f:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(a.bind(null,"a7f4"))},uniLoadMore:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-load-more/components/uni-load-more/uni-load-more")]).then(a.bind(null,"09c9"))}},r=function(){var e=this.$createElement;this._self._c},i=[]},ca9c:function(e,t,a){},dd57:function(e,t,a){"use strict";(function(e){var n=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a("7eb4")),i=n(a("af34")),o=n(a("ee10")),c=a("4860"),s=n(a("fce1")),u={components:{floatBall:function(){a.e("components/float-ball/float-ball").then(function(){return resolve(a("2251"))}.bind(null,a)).catch(a.oe)}},data:function(){return{menuItems:[],tabs:[{id:0,title:"附近农户",path:"/subPackages/shoppingPageList/nearbyFarmers/nearbyFarmers"},{id:1,title:"预卖菜品",path:"/subPackages/shoppingPageList/villageZone/villageZone"},{id:4,title:"种养来历",path:"/pages/dynamics/dynamics"},{id:6,title:"资讯信息",path:"/subPackages/shoppingPageList/realTimeInfo/realTimeInfo"},{id:7,title:"免费买菜",path:"/pages/jackpot/jackpot"}],selectedCategoryId:"",categories:[],pageData:[],currentMarketName:"",searchParams:{title:"",category_id:"",market_id:""},isloaded:!1,marketName:"",initReques:!1}},onLoad:function(){this.initPage(),e.getLocation({altitude:!0,isHighAccuracy:!0,highAccuracy:!0,type:"gcj02",success:function(t){e.setStorageSync("userlocation",JSON.stringify(t)),console.log(t)}})},onShow:function(){var t=this;return(0,o.default)(r.default.mark((function a(){var n;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.getStorageSync("userSelection"),console.log(t.marketName,n.marketName),t.marketName!=n.marketName&&t.initPage();case 3:case"end":return a.stop()}}),a)})))()},mixins:[s.default],methods:{goToshoppingPageList:function(t){t.path?(console.log(t.path),e.navigateTo({url:t.path})):e.showToast({icon:"error",title:'"'.concat(t.title,'" 暂未开发')})},fetchData:function(e){return(0,o.default)(r.default.mark((function t(){var a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c.api.marketShopList(e);case 2:return a=t.sent,t.abrupt("return",a.data);case 4:case"end":return t.stop()}}),t)})))()},initPage:function(){this.isloaded=!0,this.selectedCategoryId=0,this.fetchMarketName(),this.fetchCategories(),this.setDefaultMarketId(),this.reloadData();var t=e.getStorageSync("userSelection");this.marketName=t.marketName},setDefaultMarketId:function(){var t=e.getStorageSync("userSelection"),a=t.market_id;this.searchParams.market_id=a},fetchCategories:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c.api.cglist();case 2:a=t.sent,e.categories=[{id:0,title:"全选"}].concat((0,i.default)(a.data.listdata||[]));case 4:case"end":return t.stop()}}),t)})))()},filterByCategory:function(e){var t=this;return(0,o.default)(r.default.mark((function a(){return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.searchParams.category_id=e,t.selectedCategoryId=e,t.reloadData();case 3:case"end":return a.stop()}}),a)})))()},fetchMarketName:function(){var t=this;return(0,o.default)(r.default.mark((function a(){var n,i,o,s,u;return r.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,n=e.getStorageSync("userSelection"),n){a.next=5;break}return console.warn("未找到 userSelection"),a.abrupt("return");case 5:if(i=n.market_id,o=n.area_id,i&&o){a.next=9;break}return console.warn("未找到市场 ID 或区域 ID"),a.abrupt("return");case 9:return a.next=11,c.api.marketlist(parseInt(o));case 11:s=a.sent,u=s.data.listdata.find((function(e){return e.id===parseInt(i)})),u?t.currentMarketName=u.marketname||"未知市场":(console.warn("未找到对应的市场"),t.currentMarketName="未知市场"),a.next=19;break;case 16:a.prev=16,a.t0=a["catch"](0),console.error("获取市场名称失败:",a.t0);case 19:case"end":return a.stop()}}),a,null,[[0,16]])})))()},navigateToShopDetails:function(t){e.navigateTo({url:"/pages/ShopDetails/ShopDetails?id=".concat(t)})},toindex1:function(){e.switchTab({url:"/pages/index1/index1"})},scan:function(){e.scanCode({onlyFromCamera:!1,success:function(){var t=(0,o.default)(r.default.mark((function t(a){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a.result){t.next=7;break}return t.next=3,c.api.receiving({out_trade_no:a.result});case 3:n=t.sent,200==n.code?e.showToast({icon:"success",title:"核销成功"}):e.showToast({icon:"error",title:"核销失败"}),t.next=8;break;case 7:e.navigateTo({url:"/"+a.path});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),fail:function(e){console.error("扫码失败:",e)}})}}};t.default=u}).call(this,a("df3c")["default"])},f70a:function(e,t,a){}},[["0276","common/runtime","common/vendor"]]]);