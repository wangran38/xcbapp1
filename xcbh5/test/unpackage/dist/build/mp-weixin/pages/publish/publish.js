(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/publish"],{"29e6":function(t,e,i){"use strict";i.r(e);var n=i("d3ee"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},"2b3b":function(t,e,i){},"4df1":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(i.bind(null,"0dac"))}},o=function(){var t=this.$createElement;this._self._c},a=[]},"90a6":function(t,e,i){"use strict";var n=i("2b3b"),o=i.n(n);o.a},bb9c:function(t,e,i){"use strict";i.r(e);var n=i("4df1"),o=i("29e6");for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("90a6");var r=i("f0c5"),s=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=s.exports},bfeb:function(t,e,i){"use strict";(function(t,e){var n=i("4ea4");i("88ba");n(i("66fd"));var o=n(i("bb9c"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},d3ee:function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("2eee")),a=n(i("9523")),r=n(i("c973")),s=n(i("448a")),c=i("6c0c"),u=n(i("0e82")),d=i("a15b");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){(0,a.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={data:function(){return{pageData:[],showEditPopup:!1,currentItem:{},categories:[],pickerRange:[],selectedCategoryIndex:0,imageUploaded:!1,showEditPopup1:!1,pickerRange1:[],selectedCategoryIndex1:0,itemDescription:"",itemPrice:"",marketList:[],candidates:["斤","两"],candidate2:["元"],unit:"",unit2:"",tijiaoPrice:"",isloaded:!1,iconStatus:!0,isShowItems:!1}},mixins:[u.default],onLoad:function(){this.isloaded=!0},onShow:function(){this.reloadData()},methods:{clicKexampleBody:function(){this.iconStatus=!this.iconStatus,this.isShowItems=!this.isShowItems},selectItem:function(t){this.unit=t,this.iconStatus=!this.iconStatus,this.isShowItems=!this.isShowItems},fetchCategories:function(){var t=this;c.api.cglist().then((function(e){if(200===e.code){var i=e.data.listdata.map((function(t){return{id:t.id,content:t.content}}));t.categories=i,t.pickerRange=(0,s.default)(i.map((function(t){return t.content})))}}))},fetchMarketList:function(){var e=this;return(0,r.default)(o.default.mark((function i(){var n,a,r;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,t.getStorageSync("token"),n={limit:100,page:1},i.next=5,c.api.getMyShops(f({token:e.token},n));case 5:a=i.sent,200===a.code?(r=a.data.listdata.map((function(t){return{id:t.id,title:t.title}})),e.marketList=r,e.pickerRange1=(0,s.default)(r.map((function(t){return t.title})))):console.error("Failed to fetch market list:",a.msg),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](0),console.error("Error fetching market list:",i.t0);case 12:case"end":return i.stop()}}),i,null,[[0,9]])})))()},onCategoryChange:function(t){this.selectedCategoryIndex=t.detail.value,this.currentItem.category_id=this.categories[this.selectedCategoryIndex].id},onMarketChange:function(t){this.selectedCategoryIndex1=t.detail.value,this.currentItem.market_id=this.marketList[this.selectedCategoryIndex1].id},fetchData:function(t){return(0,r.default)(o.default.mark((function e(){var i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.api.getCommdityList(t);case 2:return i=e.sent,e.abrupt("return",i.data);case 4:case"end":return e.stop()}}),e)})))()},goTorelePage:function(){t.navigateTo({url:"/pages/release/release"})},edit:function(t){this.currentItem=f({},t),this.fetchCategories(),this.showEditPopup=!0,this.fetchCommodityDetails(t.id)},fetchCommodityDetails:function(t){var e=this;c.api.getCommodityDetails(t).then((function(t){if(200===t.code){var i=t.data.listdata[0];e.currentItem.goodsname=i.goodsname,e.currentItem.imglogo=i.imglogo;var n=e.categories.findIndex((function(t){return t.id===i.category_id}));-1!==n&&(e.selectedCategoryIndex=n)}}))},uploadcuisine:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){var i=t.tempFilePaths;if(i.length>0){var n=(0,d.useUpload)({uploadPath:"/group1/upload",tempFilePaths:i[0]}),o=n.upload;n.request;o().then((function(t){console.log(t),e.currentItem.imglogo=t,console.log("更新后的图片路径:",e.currentItem.imglogo),e.isImageSelected=!0,e.imageUploaded=!0}))}}})},shelves:function(t){this.currentItem=f({},t),this.showEditPopup1=!0,this.fetchMarketList()},closePopup:function(){this.showEditPopup=!1,this.showEditPopup1=!1},confirmEdit:function(){var e=this;if(this.currentItem.id)if(this.imageUploaded||this.currentItem.imglogo){var i=this.currentItem,n=i.id,o=i.category_id,a=i.goodsname,r=i.imglogo;c.api.editGoods({id:n,category_id:o,goodsname:a,imglogo:r}).then((function(i){200===i.code?(t.showToast({title:"商品修改成功",icon:"success"}),e.reloadData(),e.closePopup()):t.showToast({title:i.msg||"商品修改失败",icon:"none"})}))}else t.showToast({title:"请上传图片",icon:"none"});else t.showToast({title:"商品 ID 不正确",icon:"none"})},confirmShelves:function(){var e=this;console.log("Goods ID:",this.currentItem.id),this.itemPrice?this.unit?c.api.addCommodityToShop({goods_id:this.currentItem.id,shop_id:this.marketList[this.selectedCategoryIndex1].id,content:this.itemDescription,price:parseFloat(this.itemPrice),weight_name:this.unit}).then((function(i){200===i.code?(t.showToast({title:"上架成功"}),e.closePopup(),e.reloadData()):t.showToast({title:"上架失败",icon:"none"})})):t.showToast({title:"请选择单位",icon:"none"}):t.showToast({title:"请填写价格",icon:"none"})}}};e.default=h}).call(this,i("543d")["default"])}},[["bfeb","common/runtime","common/vendor"]]]);