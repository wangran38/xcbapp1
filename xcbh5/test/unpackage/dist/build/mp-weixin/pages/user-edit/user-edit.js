(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user-edit/user-edit"],{"2dad":function(e,n,t){},4401:function(e,n,t){"use strict";t.r(n);var o=t("7de3"),i=t("bb74");for(var a in i)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(a);t("714f");var u=t("f0c5"),c=Object(u["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=c.exports},"714f":function(e,n,t){"use strict";var o=t("2dad"),i=t.n(o);i.a},"7de3":function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"0dac"))}},i=function(){var e=this.$createElement;this._self._c},a=[]},b723:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t("6c0c"),i=t("a15b"),a={data:function(){return{user:{Headimgurl:"",nickname:"",phone:"",sex:""},sexOptions:["未知","男","女"],isSubmitting:!1}},onShow:function(){this.checkToken()&&e.navigateTo({url:"/pages/login/login"})},onLoad:function(){var n=this,t=e.getStorageSync("token");t?o.api.getUserProfile(t).then((function(e){console.log("用户数据:",e.data),n.user=e.data,n.user.nickname=e.data.name,n.user.sex=n.mapSexFromBackend(e.data.sex)})).catch((function(n){console.error("获取用户数据失败",n),e.showToast({title:"获取用户数据失败",icon:"none"})})):e.showToast({title:"请先登录",icon:"none"})},methods:{checkToken:function(){var n=e.getStorageSync("token");return!n},handleSexChange:function(e){this.user.sex=Number(e.detail.value)},mapSexFromBackend:function(e){return 2===e?2:1===e?1:0},mapSexToBackend:function(e){return 2===e?2:1===e?1:0},chooseImage:function(){var n=this;e.chooseImage({count:1,sizeType:["compressed","original"],sourceType:["album","camera"],success:function(e){var t=e.tempFilePaths;if(t.length>0){console.log(t);var a=(0,i.useUpload)({uploadPath:"/group1/upload",tempFilePaths:t[0],file:e.tempFiles[0]}),u=a.upload;a.request;u().then((function(e){var t=JSON.parse(e);n.user.Headimgurl=o.UPLOAD_URL+t.data.path}))}}})},submitForm:function(){var n=this;this.isSubmitting=!0,o.api.editUserProfile(this.user).then((function(n){console.log("修改成功",n),e.showToast({title:"修改成功",icon:"success"})})).catch((function(n){console.error("修改失败",n),e.showToast({title:"修改失败",icon:"none"})})).finally((function(){n.isSubmitting=!1}))}}};n.default=a}).call(this,t("543d")["default"])},bb74:function(e,n,t){"use strict";t.r(n);var o=t("b723"),i=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=i.a},da01:function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("88ba");o(t("66fd"));var i=o(t("4401"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(i.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])}},[["da01","common/runtime","common/vendor"]]]);