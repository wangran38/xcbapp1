(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/additionalinformation/additionalinformation"],{"040f":function(e,t,n){"use strict";var i=n("c21e"),a=n.n(i);a.a},"079d":function(e,t,n){},"1b41":function(e,t,n){"use strict";(function(e){var i=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("7eb4")),o=i(n("af34")),u=i(n("ee10")),c=i(n("fc06")),s=n("4860"),r=(n("64af"),n("789c")),l={data:function(){return{selectedProduct:null,products:[],timelineData:[],activeIndex:-1,tempImage:"",tempText:"",currentDate:"",formData:{page:1,limit:30},fileList:[],viewImgAndVideo:null,openId:null}},mixins:[r.myMixin],watch:{selectedProduct:function(e,t){this.lifeCycleData()}},onLoad:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var n,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.api.goodslist(e.formData);case 2:n=t.sent,200==n.code&&(i=n.data.listdata.map((function(e,t){var n=e.sellbegintime,i=e.sellendtime,a="".concat((0,c.default)(n).$y,"-").concat((0,c.default)(n).month()+1,"-").concat((0,c.default)(n).date()),o="".concat((0,c.default)(i).$y,"-").concat((0,c.default)(i).month()+1,"-").concat((0,c.default)(i).date()),u=(0,c.default)(a),s=(0,c.default)(o);s.diff(u,"day");return{value:e.id,text:e.goodsname}})),e.products=i,e.products&&(e.selectedProduct=e.products[0].value,e.lifeCycleData()));case 4:case"end":return t.stop()}}),t)})))()},methods:{viewImage:function(t){console.log(t),e.previewImage({showmenu:!1,urls:[t]})},removeItem:function(){var t=this;return(0,u.default)(a.default.mark((function n(){var i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s.api.delMoments({id:t.openId});case 2:i=n.sent,200==i.code&&e.showToast({icon:"success",title:i.message||i.msg}).then((function(e){t.initPorp(),t.lifeCycleData()}));case 4:case"end":return n.stop()}}),n)})))()},editPanelClosePopup:function(){this.initPorp()},viewPanelClosePopup:function(){this.initPorp()},lifeCycleData:function(){var e=this;return(0,u.default)(a.default.mark((function t(){var n,i;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.api.goodsinfoList({page:1,limit:100,farmersgoods_id:e.selectedProduct});case 2:n=t.sent,i=[],n.data.listdata.forEach((function(e){i.find((function(e){})),i.push(e)})),e.timelineData=n.data.listdata;case 6:case"end":return t.stop()}}),t)})))()},handleDelete:function(e){this.fileList.splice(e,1)},addRecord:function(){this.$refs.editPanel.open()},generateTimeline:function(){var e=this;if(this.selectedProduct){var t=this.products.find((function(t){return t.value===e.selectedProduct}));this.timelineData=Array.from({length:t.days},(function(e,n){return{day:n+1,date:(0,c.default)(t.endDate).subtract(t.days-n-1,"day").format("MM/DD"),fullDate:(0,c.default)(t.endDate).subtract(t.days-n-1,"day").format("YYYY-MM-DD"),image:"",text:"",status:"pending"}}))}else this.timelineData=[]},handleDayClick:function(e){if(this.$refs.viewPanel.open(),this.tempText=e.content,e.imgs){var t=[];t=e.imgs.split(",");var n=t.map((function(e){return"mp4"==e.slice(e.length-3)?{fileType:"video",path:e}:{fileType:"image",path:e}}));this.viewImgAndVideo=n}this.openId=e.id},saveImage:function(t){return new Promise((function(n,i){e.uploadFile({url:"https://image.xcbdsc.com/group1/upload",name:"file",filePath:t,formData:{output:"json2"},success:function(e){n(JSON.parse(e.data))},fail:function(t){i(t),e.showToast({title:"上传失败",icon:"error"})}})}))},initPorp:function(){e.hideLoading(),this.$refs.editPanel.close(),this.$refs.viewPanel.close(),this.tempText="",this.fileList=[]},selectImage:function(){var t=this;return(0,u.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.chooseMedia({count:9,mediaType:"mix",sourceType:["album","camera"],maxDuration:30,camera:"back",success:function(e){t.fileList=[].concat((0,o.default)(t.fileList),(0,o.default)(e.tempFiles))}});case 1:case"end":return n.stop()}}),n)})))()},saveContent:function(){var t=this;if(null!=this.selectedProduct){e.showLoading({title:"正在上传中....."});var n=this.fileList.map((function(e){return t.saveImage(e.tempFilePath)}));Promise.all(n).then((function(e){var n=[];e.forEach((function(e){e&&n.push(e.data.url)}));var i={farmersgoods_id:t.selectedProduct,imgs:n.join(","),type:1,content:t.tempText};s.api.addinfos(i).then((function(e){t.initPorp(),t.lifeCycleData()}))})).catch((function(t){e.showToast({title:"部分文件上传失败",icon:"none"})}))}else e.showToast({title:"请选择菜品",icon:"error"})},getStatusClass:function(e){return{completed:"completed"===e.status,pending:"pending"===e.status}},closeEditor:function(){this.$refs.editPanel.close(),this.tempImage="",this.tempText=""}}};t.default=l}).call(this,n("df3c")["default"])},"56eb":function(e,t,n){"use strict";n.r(t);var i=n("1b41"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"668b":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={uniFormsItem:function(){return n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(n.bind(null,"a9ba"))},uniDataSelect:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-select/components/uni-data-select/uni-data-select")]).then(n.bind(null,"73e5"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"a7f4"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"8858"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.timelineData.length),i=e.__map(e.timelineData,(function(t,n){var i=e.__get_orig(t),a=e.initTime(t.created);return{$orig:i,m0:a}})),a=e.timelineData.length;e.$mp.data=Object.assign({},{$root:{g0:n,l0:i,g1:a}})},o=[]},"703f":function(e,t,n){"use strict";(function(e,t){var i=n("47a9");n("89ee");i(n("3240"));var a=i(n("7562"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},7562:function(e,t,n){"use strict";n.r(t);var i=n("668b"),a=n("56eb");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("8454"),n("040f");var u=n("828b"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,"347c99ab",null,!1,i["a"],void 0);t["default"]=c.exports},8454:function(e,t,n){"use strict";var i=n("079d"),a=n.n(i);a.a},c21e:function(e,t,n){}},[["703f","common/runtime","common/vendor"]]]);